

```bash
**kwagä¼ ä¸å®šé•¿å‚æ•°ï¼Œå‚æ•°ä»¥**{}å½¢å¼ä¼ å…¥å‡½æ•°ï¼Œä¼ å‚å­—å…¸çš„**å¿…é¡»è¦æœ‰
mysqlçš„å¤–ç åœ¨å®šä¹‰æ—¶æå‰æƒ³å¥½on update/delete cascade/no action,å¦åˆ™ä¹‹åä¿®æ”¹éå¸¸éº»çƒ¦
python å­—ç¬¦ä¸²0å¡«å……ã€‚str.zfill()
TypeError: print() takes 0 positional arguments but 1 was givenï¼ˆå‡ºç°äº†å’Œå†…ç½®çš„printå‡½æ•°åŒåçš„å‡½æ•°ï¼Œä¸”è¿™ä¸ªè‡ªå·±çš„å‡½æ•°ä¸éœ€è¦å‚æ•°ï¼‰

windowsæ ¹æ®ç«¯å£å·æŸ¥è¿›ç¨‹å·
netstat -aon|findstr "port"
æ ¹æ®æŸ¥å‡ºæ¥çš„è¿›ç¨‹å·æ€è¿›ç¨‹
taskkill /pid pid /f
C:\Users\user>netstat -aon|findstr "8000"
  TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       42060

C:\Users\user>taskkill /pid 42060 /f
æˆåŠŸ: å·²ç»ˆæ­¢ PID ä¸º 42060 çš„è¿›ç¨‹ã€‚
```





```python
è‰ï¼Œè§£æå™¨çš„é—®é¢˜
url="https://vip.stock.finance.sina.com.cn/corp/view/vCB_AllNewsStock.php?symbol=sz{code}&Page={page}"
page=1
code="600000"
r=requests.get(url.format(code=code,page=page))
soup=bs(r.text,'html5lib')
print(soup.find('div',attrs={'class':'datelist'}))
```





```python
# fastapiçš„appè¿›ç¨‹åº”è¯¥æ”¾åœ¨main threadé‡Œé¢è·‘ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šValueError: signal only works in main thread
# æ–¹æ³•æ˜¯æŠŠrelaodè®¾ç½®ä¸ºFalse
6.py
import fastapi
from pydantic import BaseModel
from threading import Thread
import uvicorn
import time
port=8000
app=fastapi.FastAPI()

class UploadData(BaseModel):
    b : int

@app.post('/upload')
async def upload(item:UploadData):
    item_dict=item.dict()
    print(item_dict)
    return item_dict
def main():
    uvicorn.run('6:app',host="0.0.0.0", port=port, reload=False)
def print_msg():
    cnt=1
    while(1):
        print(cnt)
        time.sleep(2)
        cnt=cnt+1
if __name__=="__main__":
    main_t=Thread(target=main)
    send_t=Thread(target=print_msg)
    main_t.start()
    send_t.start()

7.py
import requests,json,time
port=8000
def send():
    cnt=0
    while(1):
        dic={'b':cnt}
        s=requests.session()
        s.keep_alive=False
        url=f'http://127.0.0.1:{port}/upload'
        r=s.post(url,data=json.dumps(dic))
        print(r)
		time.sleep(3)
        cnt+=1
send()

# è¿™æ ·åœ¨6.pyé‡Œé¢è¿è¡Œfastapiæ—¶ï¼Œä¹Ÿèƒ½è¿è¡Œprint_msgå‡½æ•°ã€‚åœ¨æœ¬é¡¹ç›®ä¸­å°±æ˜¯å‘é›†ç¾¤å‘é€search url
ï¼ˆ6.pyçš„æ‰“å°çº¿ç¨‹ï¼‰
1
ï¼ˆ6.pyçš„fastapiçº¿ç¨‹ï¼‰
?[32mINFO?[0m:     Started server process [?[36m28248?[0m]
?[32mINFO?[0m:     Waiting for application startup.
?[32mINFO?[0m:     Application startup complete.
?[32mINFO?[0m:     Uvicorn running on ?[1mhttp://0.0.0.0:8000?[0m (Press CTRL+C to quit)
2
3
4
ï¼ˆ7.pyå‘6.pyçš„fastapiçº¿ç¨‹å‘é€æ•°æ®ï¼‰
{'b': 0}
?[32mINFO?[0m:     127.0.0.1:6956 - "?[1mPOST /upload HTTP/1.1?[0m" ?[32m200 OK?[0m
5
6
{'b': 1}
?[32mINFO?[0m:     127.0.0.1:6959 - "?[1mPOST /upload HTTP/1.1?[0m" ?[32m200 OK?[0m
7
8
9
{'b': 2}
?[32mINFO?[0m:     127.0.0.1:6962 - "?[1mPOST /upload HTTP/1.1?[0m" ?[32m200 OK?[0m
10
11
{'b': 3}
?[32mINFO?[0m:     127.0.0.1:6969 - "?[1mPOST /upload HTTP/1.1?[0m" ?[32m200 OK?[0m
12
13


```



```python 
scrapyé»˜è®¤çš„è¯·æ±‚å¤´æ˜¯UAæ˜¯çˆ¬è™«æ ‡è¯†ï¼Œéœ€è¦ä¿®æ”¹

scrapyçš„ç¼–ç åšçš„æ¯”requestså¥½ï¼Œrequestè¦ç”¨apparent encodingæŒ‡å®šï¼Œå¦‚æœè¿˜æ˜¯ä¹±ç ç›´æ¥utf-8ï¼Œè€Œscrapyè¿”å›çš„response.bodyç›´æ¥å°±æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯ç¼–ç åçš„ç»“æœ

å¼€å‘æ—¶å¦‚æœç”¨åˆ°å¤šå°æœºå™¨ï¼Œéœ€è¦è¿›è¡Œç³»ç»Ÿæ—¶é’ŸåŒæ­¥
```



```python
æŸ¥çœ‹æƒ³å¼€çš„ç«¯å£æ˜¯å¦å·²å¼€ï¼šfirewall-cmd --query-port={port}/tcp
æ·»åŠ æŒ‡å®šéœ€è¦å¼€æ”¾çš„ç«¯å£ï¼šfirewall-cmd --add-port={port}/tcp --permanent
é‡è½½å…¥æ·»åŠ çš„ç«¯å£ï¼šfirewall-cmd --reload
æŸ¥è¯¢æŒ‡å®šç«¯å£æ˜¯å¦å¼€å¯æˆåŠŸï¼šfirewall-cmd --query-port={port}/tcp
ç§»é™¤æŒ‡å®šç«¯å£ï¼šfirewall-cmd --permanent --remove-port={port}/tcp


```





```python
ç»™chrome driveråŠ headers
options.add_argument('user-agent="Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36"')

å¤šä¸ªæ–‡ä»¶ç”¨åˆ°åŒä¸€ä¸ªå¸¸é‡ï¼Œä¸è¦å°†å¸¸é‡å†™åœ¨å…¶ä¸­æŸä¸ªæ–‡ä»¶ä¸­ï¼Œå•ç‹¬ç”¨ä¸€ä¸ªæ–‡ä»¶æ”¾å¸¸é‡ï¼Œå¦åˆ™ä¼šäº¤å‰å¼•ç”¨ï¼ˆcircular importï¼‰
```





```python
åœ¨è§£æhtmlæ—¶ï¼Œç”¨ç›¸åŒçš„å‡½æ•°å’Œæµ‹è¯•htmlæ–‡ä»¶ï¼Œæœ¬åœ°å¯ä»¥å¾—å‡ºç»“æœï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸Šè§£æä¸å‡ºæ¥ã€‚
ç»è¿‡å¤šæ¬¡å°è¯•ï¼Œå‘ç°æ˜¯beautiful soupçš„ç‰ˆæœ¬ä¸å¯¹ï¼Œæœ¬æœºçš„æ¯”è¾ƒä½ï¼Œè€ŒæœåŠ¡å™¨çš„ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼ˆæ— è¯­ï¼‰
æ‰€ä»¥ï¼Œè¿˜æ˜¯è€è€å®å®ç”¨è™šæ‹Ÿç¯å¢ƒå§ã€‚
æ›´æ”¹ä¾èµ–çš„ç‰ˆæœ¬
pip uninstall beautifulsoup
pip install beautifulsoup==version
```



```python
åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

å¯¼å‡ºæ‰€æœ‰é¡¹ç›®çš„ä¾èµ–
pip freeze > target.txt
å¯¼å‡ºå½“å‰é¡¹ç›®çš„ä¾èµ–
pip install pipreqs
è¿›å…¥é¡¹ç›®ç›®å½•
pipreqs ./ --encoding=utf8
```



```python
å¯è¿ç§»çš„è™šæ‹Ÿç¯å¢ƒï¼ˆå¯¹åº”çš„æœºå™¨å¯ä»¥æ²¡æœ‰ç½‘ç»œï¼‰

é¦–å…ˆåœ¨æœ¬æœºè¿è¡Œï¼Œå‡†å¤‡æ‰“åŒ…æ—¶ï¼Œpipreqs --encoding=utf8ç”Ÿæˆå½“å‰é¡¹ç›®çš„ä¾èµ–æ–‡ä»¶requirements.txtã€‚
ç”¨pip download -r requirements.txt -d . å°†æ‰€æœ‰ä¾èµ–ä¸‹è½½åˆ°å½“å‰ç›®å½•
(å¦‚æœä¸‹è½½ä¸æˆåŠŸ
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple)

åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»
virtualenv -p /usr/bin/python3.6 env
ç„¶åæŠŠé¡¹ç›®ä»£ç å’Œå‰é¢ç”Ÿæˆçš„requirements.txtæ–‡ä»¶ç§»åˆ°è™šæ‹Ÿç¯å¢ƒçš„ç›®å½•ä¸‹

ç„¶åç”¨pip install *.whlå‘½ä»¤å®‰è£…ä¾èµ–
å†ç”¨pip listè¿›è¡Œæ£€æŸ¥


pip install -r requirements.txtå®‰è£…æ‰€æœ‰
```

```python
å…¨å±€çš„pipæº
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
    
æŸæ¬¡å‘½ä»¤ä¸´æ—¶çš„pipæº
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple
```





172.16.2.40:80



```python
å­æ¨¡å—è¯·æ±‚å…³é”®è¯
æ€»æ¨¡å—å‘æ•°æ®åº“è¯·æ±‚ï¼ˆæŸç§ç±»åˆ«ï¼‰
è¿”å›ç»™å­æ¨¡å—

æ€»æ¨¡å—è®°å½•åç§»é‡

```



```python
æ€»æ§æ¨¡å—ï¼šç›‘å¬é›†ç¾¤æ€»æ§æ¨¡å—çš„çŠ¶æ€ï¼Œå¦‚æœé›†ç¾¤ä»»åŠ¡éƒ½ç»“æŸäº†ï¼Œå†æ¬¡å‘æ•°æ®åº“è¯·æ±‚å…³é”®è¯ï¼Œä¸€æ¬¡æ€§å‘é›†ç¾¤å‘é€æ‰€æœ‰å…³é”®è¯å¯¹åº”çš„ä»»åŠ¡ï¼ˆåˆ†æ‰¹å‘é€ï¼‰
å­æ¨¡å—ï¼šåªå’Œç›¸åŒæœºå™¨ä¸Šçš„é›†ç¾¤é€šä¿¡

æ€»æ§æ¨¡å—éƒ¨ç½²åœ¨ä¸€å°æœºå™¨ä¸Šå³å¯ï¼Œç”¨8002ç«¯å£
å­æ¨¡å—éœ€è¦éƒ¨ç½²åœ¨æ‰€æœ‰æœºå™¨ä¸Šï¼Œç”¨8001ç«¯å£ï¼ˆè¯¥æœºå™¨å¿…é¡»éƒ¨ç½²é›†ç¾¤ï¼‰
```



```python
è¯»å–æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶åå’Œå¤§å°(os.walk,os.stat)
æ ¹æ®-å’Œ.è¿›è¡Œåˆ†è¯ï¼Œå°†ç»“æœè½¬ä¸ºå°å†™ï¼Œæ”¾åˆ°åˆ—è¡¨ä¸­

å¯¹åˆ—è¡¨åŸºäºsong_nameè¿›è¡Œæ’åº
éå†åˆ—è¡¨ï¼Œåˆ©ç”¨difflibä¸å‰é¢ä¸€ä¸ªå…ƒç´ ï¼ˆå­—å…¸ï¼‰çš„song_nameè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ­Œæ›²åçš„ç›¸ä¼¼æ€§è¾¾åˆ°90%ï¼Œåˆ é™¤è¾ƒå°çš„æ–‡ä»¶

```



æ€»æ§æ¨¡å—æ”¾åœ¨55:8002ï¼Œå…¶ä»–æ¯ä¸€å°æœºå™¨ä¸Šéƒ½æŠŠå­æ¨¡å—æ”¾:8001ä¸Šã€‚è¿è¡Œæ—¶ï¼Œå…ˆè¿è¡Œå­æ¨¡å—ï¼Œç„¶åè¿è¡Œæ€»æ§æ¨¡å—



```python
(ç»Ÿä¸€å®‰è£…python3.7.10)ç¬¦å·é“¾æ¥ä¸ºpython3.7

ä¸Šä¼ python3.7.10å‹ç¼©åŒ…è‡³/root

å¸è½½3.7
apt-get -y remove --auto-remove python3.7
cd /root
è§£å‹
tar -zxvf Python-3.7.10.tgz
cd Python-3.7.10
apt install libffi-dev -y
./configure --prefix=/usr/local
make && make install
ln -s /usr/local/python3.7/bin/python3.7 /usr/bin/python3.7

ä¼ æ€»æ§æ¨¡å—çš„å‹ç¼©åŒ…main_control.taræ–‡ä»¶çš„55æœºå™¨çš„/ç›®å½•
mkdir /home/main_control
cd /home/main_control
python3.7 -m venv env
source ./env/bin/activate
mv /main_control.tar /home/main_control
tar -xf main_control.tar
cd main_control


ä¼ å­æ¨¡å—çš„å‹ç¼©åŒ…ï¼ˆåŒ…å«requirements.txtï¼‰åˆ°å„ä¸ªæœºå™¨
æ–‡ä»¶è¿ç»´
å»ºç«‹è™šæ‹Ÿç¯å¢ƒï¼Œæ¿€æ´»
mkdir /home/spider
cd /home/spider
python3.6 -m venv env
source ./env/bin/activate
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip install -r requirements.txt
nohup python -u main.py > res.txt &
ç§»åŠ¨å­æ¨¡å—
mv /child.tar /home/spider
è§£å‹ï¼Œå®‰è£…ä¾èµ–ï¼Œè¿è¡Œ
tar -xf child.tar
cd child
é…ç½®pipæº
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

pip install -r requirements.txt
nohup python -u main.py > res.txt &
```



å°†å‘½ä»¤å†™æˆè„šæœ¬ï¼š

å¸è½½3.7



å®‰è£…3.7.10

å»ºç«‹è™šæ‹Ÿç¯å¢ƒï¼Œæ¿€æ´»

ä¼ å­æ¨¡å—çš„å‹ç¼©åŒ…ï¼ˆåŒ…å«requirements.txtï¼‰åˆ°å„ä¸ªæœºå™¨ï¼Œè§£å‹ï¼Œå®‰è£…ä¾èµ–ï¼Œè¿è¡Œ



è£…é¥°å™¨

```python
import math
import time

def cal_time(func):
    def wrapper(*args):
        start = time.time()
        cnt=func(args[0])
        end=time.time()
        print(end - start)
        return cnt
    return wrapper

def is_prime(n):
    if n<2:
        return False
    else:
        tmp=math.sqrt(n)
        for i in range(2,int(tmp)+1):
            if n%i==0:
                return False
        return True

@cal_time
def prime_numbers(n):
    cnt=0
    for i in range(1,n):
        if is_prime(i):
            print(i)
            cnt+=1
    return cnt

print(prime_numbers(1000))
```



è£…é¥°å™¨+å¤šçº¿ç¨‹

```python
import time

import requests
import threading

headers={
    'User-Agent' : 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36'
}

def cal_time(func):
    def wrapper(*args):
        start=time.time()
        func(args[0])
        end=time.time()
        print(f'{args[1]} ç”¨æ—¶: {end-start}')
    return wrapper
def access(url):
    try:
        r = requests.get(url, headers=headers)
        r.raise_for_status()
    except Exception as e:
        print(e)
    else:
        print(len(r.text))
@cal_time
def single_thread(urls):
    for url in urls:
        access(url)

@cal_time
def multi_thread(urls):
    threads=[]
    for url in urls:
        threads.append(threading.Thread(target=access,args=(url,)))
    for thread in threads:
        thread.start()
    for  thread in threads:
        thread.join()
urls=[f'https://www.cnblogs.com/#p{page}'
      for page in range(1,50+1)
      ]
single_thread(urls,'å•çº¿ç¨‹')
multi_thread(urls,'å¤šçº¿ç¨‹') 
```



lambda

```python
f = lambda x:x+1
print(f(2))

countries = []
with open('data.csv','r',encoding='utf8') as f:
    for i in f.readlines():
        i = i.split(',')
        try:
            countries.append((i[1],int(i[-1]),))
        except:
            pass
countries.sort(key= lambda x:x[1])
for i in countries:
    print(i)
```





```mysql
create database if not exists test_producer_consumer;
# å°è¯´è¡¨
å­˜æ”¾å„ä¸ªå°è¯´çš„å°è¯´å,ä½œè€…å
create table if not exists novels
(
	novel_id int primary key auto_increment,
    novel_name char(50) not null,
    novel_link char(50),
    author_name char(30)
)engine=innodb default charset=utf8;

# ç« èŠ‚è¡¨ä»¥æŸä¸ªå°è¯´çš„novel_idå¤–é”®
create table if not exists chapters
(
	id int primary key auto_increment,
	novel_id int not null,
    chapter_name char(50),
    link char(100),
    content text
)engine=innodb default charset=utf8;
```





çº¿ç¨‹å®‰å…¨

```python
import threading
import time
class Account:
    def __init__(self,balance):
        self.balance = balance

def draw(account:Account,amount):
    if account.balance >= amount:
        time.sleep(0.1)
        print(f"balance:{account.balance} withdraw {amount}")
        account.balance -= amount
        print(f'balance is {account.balance}')
    else:
        print(f'balance {account.balance} < {amount}')

if __name__=="__main__":
    test = Account(600)
    amount = 500
    ta = threading.Thread(target=draw,args=(test,amount),name='ta')
    tb = threading.Thread(target=draw,args=(test,amount),name='tb')

    ta.start()
    tb.start()
#balance:600 withdraw 500
#balance:600 withdraw 500
#balance is 100
#balance is -400
```



åŠ ä¸Šé”

```python
import threading
import time
class Account:
    def __init__(self,balance):
        self.balance = balance
def draw(account:Account,amount):
    print(threading.current_thread().name,'outer')
    with lock:
        print(threading.current_thread().name)
        if account.balance >= amount:
            time.sleep(2)
            print(f"balance:{account.balance} withdraw {amount}")
            account.balance -= amount
            print(f'balance is {account.balance}')
        else:
            print(f'balance {account.balance} < {amount}')
if __name__=="__main__":
    test = Account(600)
    amount = 500
    lock = threading.Lock()
    ta = threading.Thread(target=draw,args=(test,amount),name='ta')
    tb = threading.Thread(target=draw,args=(test,amount),name='tb')
    ta.start()
    tb.start()
ta outer
ta
tb outer
balance:600 withdraw 500
balance is 100
tb
balance 100 < 500
```



![image-20210819202504516](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210819202504516.png)

çº¿ç¨‹çš„æ–°å»ºå’Œç»ˆæ­¢æœ‰ç³»ç»Ÿå¼€é”€ï¼Œä¸ºäº†å®ç°çº¿ç¨‹å¤ç”¨ï¼ˆå¥½åƒåŠ ä¸Šwhileä¹Ÿèƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼‰ï¼Œå¼•å…¥çº¿ç¨‹æ± å’Œä»»åŠ¡é˜Ÿåˆ—ï¼Œä»»åŠ¡æ¥äº†ï¼Œå¹¶ä¸ç›´æ¥ç»™çº¿ç¨‹ï¼Œè€Œæ˜¯æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å–ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ç»“æŸåï¼Œè¿”å›çº¿ç¨‹æ± ï¼Œè‡ªèº«å¹¶ä¸ç»ˆæ­¢ï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚

![image-20210819202816462](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210819202816462.png)





```python
a = list(zip([1,2,3],[2,3,4]))
# æŒ‰ç…§é¡ºåºå»ºç«‹å…ƒç»„ï¼Œç„¶åæ‰“åŒ…ä¸ºåˆ—è¡¨
print(a)
for i,j in a:
    print(i)
    print(j)
# [(1, 2), (2, 3), (3, 4)]
# 1
# 2
# 2
# 3
# 3
# 4
```



![image-20210819211830525](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210819211830525.png)



```python
mapæ“ä½œ
mapä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯è¿­ä»£çš„å‚æ•°åˆ—è¡¨ï¼ˆå¤šç»„å‚æ•°ï¼‰
mapè¿”å›æ‰§è¡Œç»“æœæ„æˆçš„åˆ—è¡¨ï¼Œæ‰§è¡Œç»“æœçš„é¡ºåºå’Œä¼ å…¥çš„è‹¥å¹²ç»„å‚æ•°çš„é¡ºåºæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ˆæ‰€ä»¥å«mapï¼Œå³æ˜ å°„ï¼‰
è¿™ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿”å›çš„htmlså¹¶ä¸æ˜¯çœŸçš„æŒ‡å‘ä¸€ç»„è¿”å›çš„ç»“æœ

with concurrent.futures.ThreadPoolExecutor() as pool:
    start = time.time()
    htmls = pool.map(blog_spider.craw, blog_spider.urls)
    end = time.time()
    print(htmls)
    print(end-start)
    htmls = list(zip(blog_spider.urls, htmls))
    print(1)
    for url, html in htmls:
        print(url, len(html))

<generator object Executor.map.<locals>.result_iterator at 0x000001C5A442E678>
0.10804033279418945
1
https://www.cnblogs.com/sitehome/p/1 68519
https://www.cnblogs.com/sitehome/p/2 68587

blog_spider.crawé‡Œé¢æœ‰ä¸ªæš‚åœ10sçš„time.sleep()
ä½†æ˜¯pool.mapçš„æ“ä½œåªç”¨äº†0.1ç§’ï¼Œæ˜¾ç„¶åªæ˜¯åˆ›å»ºäº†ä»»åŠ¡ï¼Œå¹¶äº¤ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å®Œæˆï¼Œå¹¶æ²¡æœ‰çœŸæ­£çš„è¿”å›ç»“æœç»™html
è¦print(1)çš„æ—¶å€™ç­‰å¾…äº†ç›¸å½“ä¸€æ®µæ—¶é—´ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæ­¤æ—¶çœŸæ­£è¦ç”¨åˆ°htmlsï¼ˆè¿”å›çš„ç»“æœï¼‰ï¼Œæ­¤æ—¶åˆæ²¡æœ‰è®¾ç½®timeoutï¼Œæ‰€ä»¥éœ€è¦ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆä»»åŠ¡å¹¶è¿”å›ç»“æœã€‚
è¯´åˆ°åº•ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Œåªæœ‰ç­‰éœ€è¦ç»“æœçš„æ—¶å€™ï¼Œæ‰ä¼šç­‰å¾…ã€‚
è€Œç”¨çº¿ç¨‹é€šä¿¡çš„queue.Queue.get/putï¼Œapiæ˜¯é˜»å¡çš„ï¼Œéœ€è¦ç­‰å¾…ã€‚

submitæ“ä½œ
with concurrent.futures.ThreadPoolExecutor() as pool:
    futures = {}
    for url, html in htmls:
        future = pool.submit(blog_spider.parse, html)
        print(future.done())
        futures[future] = url
#
    for future, url in futures.items():
        print(future.done())
False
False
True
True
True
True
True
True
True
True
submitæ“ä½œä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œï¼Œè¿”å›çš„futureï¼ˆå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªåœ¨æœªæ¥å®Œæˆçš„æ“ä½œï¼Œè¿™æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ï¼‰ä¹Ÿä¸æ˜¯çœŸæ­£çš„å‡½æ•°æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çš„done()æ–¹æ³•æŸ¥çœ‹æ˜¯å¦å®Œæˆã€‚
åœ¨åˆšæŠŠä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± æ—¶ï¼Œæ‰“å°future.done()å‘ç°äº†Falseï¼Œè¯æ˜ç¡®å®æ˜¯å¼‚æ­¥ã€‚

å½“æˆ‘ä»¬éœ€è¦æ‰§è¡Œç»“æœï¼Œä¹Ÿå°±æ˜¯future.resultæ—¶ï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œä¼šç­‰å¾…ç¨‹åºæ‰§è¡Œã€‚
with concurrent.futures.ThreadPoolExecutor() as pool:
    futures = {}
    for url, html in htmls:
        future = pool.submit(blog_spider.parse, html)
        print(future.done())
        futures[future] = url
    for future, url in futures.items():
        print(future.done())
        
    print('parse over')
False
False
False
False
False
False
False
False
False
False
parse over
åœ¨parseå‡½æ•°ä¸­time.sleep(5)ï¼Œå‘ç°æ‰§è¡Œåˆ°parse_overå‡ºï¼Œç¨‹åºå¹¶ä¸ä¼šexitï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿˜éƒ½åœ¨waitã€‚

å¦‚æœæ”¹æˆä½¿ç”¨future.result()è®¿é—®ç¨‹åºæ‰§è¡Œçš„ç»“æœï¼Œä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚
with concurrent.futures.ThreadPoolExecutor() as pool:
    futures = {}
    for url, html in htmls:
        future = pool.submit(blog_spider.parse, html)
        print(future.done())
        futures[future] = url
    for future, url in futures.items():
        print(future.result()[:10])
        print(future.done())
    print('parse over')
False
False
False
False
False
[('https://www.cnblogs.com/likeyou99315/p/15163929.html', 'shell ç¼–ç¨‹'), ('https://www.cnblogs.com/RioTian/p/15163878.html', 'ã€åŠ¨æ€è§„åˆ’ã€‘æ ‘å½¢DPå®Œå…¨è¯¦è§£ï¼'), ('https://www.cnblogs.com/tencentdb/p/15163584.html', 'è…¾è®¯äº‘TDSQL MySQLç‰ˆ - å¼€å‘æŒ‡å— äºŒçº§åˆ†åŒº'), ('https://www.cnblogs.com/longronglang/p/15157307.html', 'å¯»æ‰¾å†™ä»£ç æ„Ÿè§‰ï¼ˆäºŒï¼‰ä¹‹ Spring Boot  é¡¹ç›®å±æ€§é…ç½®'), ('https://www.cnblogs.com/winlsr/p/15163471.html', 'è®¡ç®—æœºé¢è¯•é‡éš¾ç‚¹ ä¹‹ æ“ä½œç³»ç»Ÿ'), ('https://www.cnblogs.com/gonghr/p/15163292.html', 'ã€MySQLã€‘è‡ªå®šä¹‰æ•°æ®åº“è¿æ¥æ± å’Œå¼€æºæ•°æ®åº“è¿æ¥æ± çš„ä½¿ç”¨'), ('https://www.cnblogs.com/o2team/p/15163210.html', 'ä¸æ‡‚ç‰©ç†çš„å‰ç«¯ä¸æ˜¯å¥½çš„æ¸¸æˆå¼€å‘è€…ï¼ˆä¸€ï¼‰â€”â€” ç‰©ç†å¼•æ“åŸºç¡€'), ('https://www.cnblogs.com/beityluo/p/15163095.html', 'ç¥ç»ç½‘ç»œï¼šnumpyå®ç°ç¥ç»ç½‘ç»œæ¡†æ¶'), ('https://www.cnblogs.com/CodeReaper/p/15162537.html', 'å•ç‰‡æœºå­¦ä¹ ï¼ˆå…­ï¼‰å®šæ—¶å™¨çš„ä½¿ç”¨'), ('https://www.cnblogs.com/rebeyond/p/15162264.html', 'ã€åŸåˆ›ã€‘Javaå†…å­˜æ”»å‡»æŠ€æœ¯æ¼«è°ˆ')]
True

è¿™æ¬¡æ‰§è¡Œçš„ç‰¹ç‚¹æ˜¯ï¼Œè¾“å‡ºæ‰€æœ‰Falseåï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆå› ä¸ºæ²¡æœ‰timeoutï¼Œæ‰€ä»¥ä¼šç­‰å¾…ç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœï¼Œç„¶åæ‰“å°ï¼‰ï¼Œä¹‹åå†æ‰“å°ç»“æœå°±ä¸éœ€è¦ç­‰å¾…äº†ï¼Œå› ä¸ºæ˜¯åœ¨returnä¹‹å‰time.sleep()ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚

æ€»çš„æ¥è¯´ï¼Œsubmitè¿”å›çš„futureæ˜¯ä¸€ä¸ªå¼‚æ­¥å¯¹è±¡ï¼Œåœ¨è¿™é‡Œä¸ä¼šç­‰å¾…ï¼Œä½†æ˜¯å¦‚æœæƒ³è®¿é—®æ‰§è¡Œç»“æœï¼Œåˆ™å¿…é¡»ç­‰å¾…ã€‚
é€šè¿‡æºç æ¥æ£€æµ‹çŒœæƒ³ï¼š
ç¡®å®å¦‚æ­¤ï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ç­‰å¾…timeoutæ®µæ—¶é—´ï¼Œæ­¤åå†æŸ¥çœ‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œè‹¥å®Œæ¯•ï¼Œè¿”å›ç»“æœï¼›å¦åˆ™ï¼ŒæŠ¥é”™ã€‚
timeouté»˜è®¤ä¸ºæ²¡æœ‰é™åˆ¶
def result(self, timeout=None):
    """Return the result of the call that the future represents.

        Args:
            timeout: The number of seconds to wait for the result if the future
                isn't done. If None, then there is no limit on the wait time.

        Returns:
            The result of the call that the future represents.

        Raises:
            CancelledError: If the future was cancelled.
            TimeoutError: If the future didn't finish executing before the given
                timeout.
            Exception: If the call raised then that exception will be raised.
        """
    with self._condition:
        if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
            raise CancelledError()
            elif self._state == FINISHED:
                return self.__get_result()

            self._condition.wait(timeout)

            if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()
                else:
                    raise TimeoutError()
                    
as_completed()
ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„keyæ˜¯submitè¿”å›çš„å¼‚æ­¥å¯¹è±¡futureï¼Œvalueä¸€èˆ¬å–å‚æ•°ï¼Œè¿›è€Œå»ºç«‹å¯¹åº”å…³ç³»ã€‚
ä¸Šé¢ç›´æ¥ç”¨
for future, url in futures.items():
    print(future.result()[:10])
è¿”å›çš„ç»“æœæ˜¯æŒ‰ç…§å»ºç«‹futureçš„é¡ºåºè¿”å›çš„ï¼Œå¦‚æœéœ€è¦ç­‰å¾…ï¼Œåˆ™é¡ºåºç­‰å¾…ï¼›å¦‚æœè¿™ä¸€æ­¥çš„resultè¿˜éœ€è¦è¿›ä¸€æ­¥å¤„ç†ï¼Œæ˜¾ç„¶æ•ˆç‡æ¯”è¾ƒä½ã€‚

as_completedç›´æ¥è¿”å›å®Œæˆçš„å¼‚æ­¥futureå¯¹è±¡ï¼Œè¿›è€Œå¾—åˆ°æ‰§è¡Œç»“æœã€‚
å¦‚ä½•ä¸ä¹‹å‰çš„å‚æ•°å»ºç«‹å¯¹åº”å…³ç³»å‘¢ï¼Ÿä½¿ç”¨å­—å…¸
with concurrent.futures.ThreadPoolExecutor() as pool:
    futures = {}
    for url, html in htmls:
        future = pool.submit(blog_spider.parse, html)
        futures[future] = url
    for future in concurrent.futures.as_completed(futures):
        url = futures[future]
        print(url, future.result()[:3])
https://www.cnblogs.com/sitehome/p/4 [('https://www.cnblogs.com/wzh2010/p/13528320.html', 'Javaï¼šå¯¼å‡ºExcelå¤§æ‰¹é‡æ•°æ®çš„ä¼˜åŒ–è¿‡ç¨‹'), ('https://www.cnblogs.com/dechinphy/p/two-pass.html', 'Python3å®ç°Two-Passç®—æ³•æ£€æµ‹åŒºåŸŸè¿é€šæ€§'), ('https://www.cnblogs.com/timlly/p/15156626.html', 'å‰–æè™šå¹»æ¸²æŸ“ä½“ç³»ï¼ˆ10ï¼‰- RHI')]
https://www.cnblogs.com/sitehome/p/3 [('https://www.cnblogs.com/logchen/p/15159382.html', 'ä¸€ç¯‡æ–‡ç« ææ‡‚å¯†ç å­¦åŸºç¡€åŠSSL/TLSåè®®'), ('https://www.cnblogs.com/xuliuzai/p/15156886.html', 'MongoDBå®ä¾‹é‡å¯å¤±è´¥æ¢ç©¶ï¼ˆå¤§äº‹åŠ¡Redoå¯¼è‡´ï¼‰'), ('https://www.cnblogs.com/wushengwuxi/p/15159259.html', 'è‡ªå®šä¹‰æµå¼å¸ƒå±€ï¼šViewGroupçš„æµ‹é‡ä¸å¸ƒå±€')]
https://www.cnblogs.com/sitehome/p/5 [('https://www.cnblogs.com/willick/p/15155192.html', '[.NETå¤§ç‰›ä¹‹è·¯ 007] è¯¦è§£ .NET ç¨‹åºé›†'), ('https://www.cnblogs.com/wtzbk/p/15154423.html', 'Kubernetesä»‹ç»'), ('https://www.cnblogs.com/zwtblog/p/15155100.html', 'MVCé…ç½®åŸç†-æºç ')]
https://www.cnblogs.com/sitehome/p/2 [('https://www.cnblogs.com/rustfisher/p/15161247.html', 'Android WorkManagerä½¿ç”¨å…¥é—¨'), ('https://www.cnblogs.com/megengine/p/15161238.html', 'å€¼å¾—æ”¶è— | æ·±åº¦å‰–æ TensorCore å·ç§¯ç®—å­å®ç°åŸç†'), ('https://www.cnblogs.com/liboware/p/15161195.html', 'ğŸ†ã€JavaæŠ€æœ¯ä¸“åŒºã€‘ã€Œå¼€å‘å®æˆ˜ä¸“é¢˜ã€Lombokæ’ä»¶å¼€å‘å®è·µå¿…çŸ¥å¿…ä¼šæ“ä½œï¼')]
https://www.cnblogs.com/sitehome/p/1 [('https://www.cnblogs.com/CKExp/p/15163975.html', 'ç²¾ç®€ABPçš„æ¨¡å—ä¾èµ–'), ('https://www.cnblogs.com/likeyou99315/p/15163929.html', 'shell ç¼–ç¨‹'), ('https://www.cnblogs.com/RioTian/p/15163878.html', 'ã€åŠ¨æ€è§„åˆ’ã€‘æ ‘å½¢DPå®Œå…¨è¯¦è§£ï¼')]
```



åˆ©ç”¨çº¿ç¨‹æ± å¯¹webæœåŠ¡è¿›è¡ŒåŠ é€Ÿ







```python
webæœåŠ¡æµ‹é€Ÿï¼ˆwindowsï¼Œlinuxéƒ½å¯ä»¥ç”¨ï¼‰
curl -o /dev/null -s -w "time_namelookup:%{time_namelookup}\ntime_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http://www.baidu.com"

C:\Users\user>curl -o /dev/null -s -w "time_namelookup:%{time_namelookup}\ntime_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http://www.baidu.com"
time_namelookup:0.031000
time_connect: 0.047000
time_starttransfer: 0.078000
time_total: 0.078000
    
windowsæŸ¥çœ‹ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -ano -p tcp | find "8000" >nul 2>nul && echo ç«¯å£å·²å¼€å¯ || echo æœªå¼€å¯
netstat -ano -p tcp | find "8307"
å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¡¨ç¤ºæ²¡æœ‰findåˆ°ï¼Œæ‰€ä»¥æ²¡æœ‰å¼€æ”¾
```



æ²¡æœ‰ç”¨å¤šçº¿ç¨‹è¿›è¡ŒioåŠ é€Ÿ

```python
import json
import flask,time
import concurrent.futures

app = flask.Flask('main')

def read_file():
    time.sleep(0.1)
    return 'read_file'
def read_io():
    time.sleep(0.2)
    return 'read_io'
def read_api():
    time.sleep(0.3)
    return 'read_api'

@app.route('/')
def index():
    file_result = read_file()
    io_result = read_io()
    api_result = read_api()
    return json.dumps(
        {
            'file_result':file_result,
            'io_result': io_result,
            'api_result': api_result,
        }
    )

if __name__=='__main__':
    app.run(host='localhost',port=8000,debug=True)
    
C:\Users\user>curl -o /dev/null -s -w "time_namelookup:%{time_namelookup}\ntime_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http://localhost:8000/"
time_namelookup:0.016000
time_connect: 0.219000
time_starttransfer: 0.844000
time_total: 0.844000
```



åˆ©ç”¨å¤šçº¿ç¨‹è¿›è¡ŒioåŠ é€Ÿã€‚



```python
import json

import flask,time
import concurrent.futures

app = flask.Flask('main')
pool = concurrent.futures.ThreadPoolExecutor()

def read_file():
    time.sleep(0.1)
    return 'read_file'
def read_io():
    time.sleep(0.2)
    return 'read_io'
def read_api():
    time.sleep(0.3)
    return 'read_api'
@app.route('/')
def index():
    file_result = pool.submit(read_file)
    io_result = pool.submit(read_io)
    api_result = pool.submit(read_api)
    return json.dumps(
        {
            'file_result':file_result.result(),
            'io_result': io_result.result(),
            'api_result': api_result.result(),
        }
    )

if __name__=='__main__':
    app.run(host='localhost',port=8000,debug=True)
    
C:\Users\user>curl -o /dev/null -s -w "time_namelookup:%{time_namelookup}\ntime_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http://localhost:8000/"
time_namelookup:0.016000
time_connect: 0.219000
time_starttransfer: 0.532000
time_total: 0.532000
```

æé€Ÿä¸‰ç§’ï¼Œå¤§æ¦‚å°±æ˜¯å¹¶å‘æ‰§è¡Œä¸‰ä¸ªioæ“ä½œçš„èŠ‚çœä¸‹æ¥çš„æ—¶é—´ã€‚





GILï¼špythoné»˜è®¤åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ‰€ä»¥åªèƒ½ç”¨cpuçš„ä¸€ä¸ªæ ¸ï¼Œ

![image-20210820110531063](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210820110531063.png)



![image-20210820110525867](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210820110525867.png)





æ ¹æ®è¿›ç¨‹åæ€è¿›ç¨‹

```python
ps -aux|grep process_name
æŸ¥å‡ºæ¥å¾ˆå¤šä¿¡æ¯ï¼Œä¸æ–¹ä¾¿è‡ªåŠ¨åŒ–å¤„ç†
pgrep -f process_name
ps -ef | grep mysql | grep -v grep | awk '{print $2}'
åªæ˜¾ç¤ºè¿›ç¨‹idï¼Œç¼ºç‚¹æ˜¯å¯èƒ½æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œè¯¯æ€
kill -9 $(pgrep -f process_name)æˆ–è€…æ‰‹åŠ¨æŒ‡å®šè¿›ç¨‹å·
```



æ ¹æ®ç«¯å£å·æ€è¿›ç¨‹

```python
lsof -i:por_num
    
```



![image-20210825155231017](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210825155231017.png)



è¿™ç§æƒ…å†µå®‰è£…è™šæ‹Ÿç¯å¢ƒåï¼Œbinç›®å½•ä¸‹æ²¡æœ‰activateï¼Œå®‰è£…pythonè§£é‡Šå™¨å¯¹åº”çš„åŒ…å³å¯ã€‚

è¿™é‡Œç”¨çš„python3.7ï¼Œæ‰€ä»¥

`apt-get install python3.7-venv`



dockeræ ¹æ®å®¹å™¨åˆ¶ä½œé•œåƒå¹¶å‘å¸ƒåˆ°ç§æœ‰ä»“åº“ä¸­

```bash
nslab@nslab:~$ docker images
REPOSITORY                 TAG       IMAGE ID       CREATED         SIZE
centos                     7         8652b9f0cb4c   9 months ago    204MB

nslab@nslab:~$ docker run -itd --name test_private_commit centos:7 /bin/bash
c9d443f6ae535c20382fc1bf210bdb62afbda4a020373c2f966a9921d8621cb0

nslab@nslab:~$ docker ps
CONTAINER ID   IMAGE                    COMMAND                  CREATED             STATUS          PORTS                                           NAMES
c9d443f6ae53   centos:7                 "/bin/bash"              16 seconds ago      Up 14 seconds                                                   test_private_commit

nslab@nslab:~$ docker attach c9d443f6ae53
[root@c9d443f6ae53 /]# 
å®‰è£…äº†ä¸€ç‚¹ä¸œè¥¿å
ctrl+p+qï¼Œé€€å‡ºå®¹å™¨ï¼Œå¹¶ä¿æŒå®¹å™¨è¿è¡Œ

nslab@nslab:~$ docker ps
CONTAINER ID   IMAGE                    COMMAND                  CREATED             STATUS          PORTS                                           NAMES
c9d443f6ae53  

å°†å®¹å™¨æ‰“åŒ…ä¸ºé•œåƒï¼Œdocker commit container_name/id iamge_name:tag
nslab@nslab:~$ docker commit test_private_commit test_centos:1.0
sha256:0d41918dafa35206e20806221b601e8c3682e1d5fba072a2f9626f5181b2942d

nslab@nslab:~$ docker images
REPOSITORY                 TAG       IMAGE ID       CREATED          SIZE
test_centos                1.0       0d41918dafa3   42 seconds ago   388MB

dockerç™»å½•åˆ°æŸä¸ªç§äººç”¨æˆ·
nslab@nslab:~$ docker login -u 819987540
Password: 
WARNING! Your password will be stored unencrypted in /home/nslab/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store



ä¿®æ”¹repository
docker tag image_id user_name/image_name:tag

pushåˆ°ç§äººä»“åº“
docker push image_id:tag
nslab@nslab:~$ docker tag 0d41918dafa3 819987540/test:1.0
nslab@nslab:~$ docker push 819987540/test:1.0
The push refers to repository [docker.io/819987540/test]
3f0f5b30f818: Pushed 
174f56854903: Mounted from 819987540/ad_centos7 
1.0: digest: sha256:77660dab31670c53d78e05b01a9502b44d5b27caca71f951d73689f6e52863c9 size: 741
```

![image-20210825204900289](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210825204900289.png)



æˆ–è€…å°†é•œåƒä¿å­˜ä¸ºæœ¬åœ°ï¼ˆdocker hubå¾ˆæ…¢ï¼‰

docker save image_id/name -o file_path.tar



è¿è¡Œpythonæ—¶ï¼Œå¯¹ä¸­æ–‡è§£é‡Šä¸äº†ï¼Œå› ä¸ºç³»ç»Ÿå¯èƒ½ç”¨çš„asciiç¼–ç 

è®¾ç½®ç¯å¢ƒå˜é‡å³å¯

```python
vim /etc/profile
æ·»åŠ ä¸€å¥export LANG="en_US.UTF-8"
source /etc/profileå³å¯
```





cpulimit -e ./xmrig -c 1 -l 50   -iv



# linux cpu

## ç‰©ç†cpuï¼ˆphysicalï¼‰

ä¸»æ¿ä¸Šå¤šå°‘é¢—cpu



## cpuæ ¸æ•°ï¼ˆcoreï¼‰

ç°ä»£cpuä¸€èˆ¬ä¸ºå¤šæ ¸cpu



## é€»è¾‘cpu/çº¿ç¨‹æ•°ï¼ˆprocessorï¼‰

è¿™é‡Œçš„çº¿ç¨‹ä¸æ˜¯æ“ä½œç³»ç»Ÿå±‚æ¬¡ä»¥ä¸Šçš„çº¿ç¨‹æ•°ã€‚ä¸€èˆ¬ä¸€ä¸ªcpuæ ¸å¯¹åº”ä¸€ä¸ªé€»è¾‘cpuï¼Œä½†æ˜¯è¶…çº¿ç¨‹æŠ€æœ¯å¯ä»¥è®©ä¸€ä¸ªcoreå¯¹åº”å¤šä¸ªprocessorã€‚

## æŸ¥çœ‹

```python
# æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•°
cat /proc/cpuinfo|grep "physical id"|sort -u|wc -l
# æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUä¸­coreçš„ä¸ªæ•°(å³æ ¸æ•°)
cat /proc/cpuinfo|grep "cpu cores"|uniq
# æŸ¥çœ‹é€»è¾‘CPUçš„ä¸ªæ•°
cat /proc/cpuinfo|grep "processor"|wc -l
# æŸ¥çœ‹CPUçš„åç§°å‹å·
cat /proc/cpuinfo|grep "name"|cut -f2 -d:|uniq
```



## ä½œç”¨

æœ‰ä¸€å°æœºå™¨ï¼Œæ˜¯ä¸¤ä¸ªé€»è¾‘cpuï¼Œè¿è¡Œä¸¤ä¸ªåŒåçš„æŒ–çŸ¿ç¨‹åºã€‚

![image-20210828221220649](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210828221220649.png)

æ˜¾ç„¶è¿™ä¸¤ä¸ªç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ªé€»è¾‘cpuä¸Šï¼Œå¯¹cpuå‹æ¦¨çš„ä¸å¤Ÿç‹ ã€‚

ç°åœ¨è®©ä»–ä»¬è¿è¡Œåœ¨ä¸åŒçš„é€»è¾‘cpuä¸Šã€‚

### æŸ¥çœ‹è¿›ç¨‹è¿è¡Œçš„é€»è¾‘cpu/processor

```bash
root@iZf8z0awjk4b1twtysjcdaZ:~# ps -eo pid,args,psr|grep xmrig
 5462 ./xmrig                       1
14106 ./xmrig --cpu-affinity=0      1
16173 grep --color=auto xmrig       1
```



### æŸ¥çœ‹è¿›ç¨‹çš„cpuäº²å’ŒåŠ›affinity

```bash
# -pæŒ‰ç…§è¿›ç¨‹idæ¥è¿›è¡Œé€‰æ‹©
# -cç”¨åè¿›åˆ¶æ¥è¡¨ç¤ºäº²å’Œå“ªä¸ªcpu processor
taskset -cp pid
root@iZf8z0awjk4b1twtysjcdaZ:~# taskset -cp 5462
pid 5462's current affinity list: 0,1
root@iZf8z0awjk4b1twtysjcdaZ:~# taskset -cp 14106
pid 14106's current affinity list: 0,1
```



### ä¿®æ”¹è¿›ç¨‹çš„cpuäº²å’ŒåŠ›

```bash
taskset -cp new_mask pid

root@iZf8z0awjk4b1twtysjcdaZ:~# taskset -cp 0 14106
pid 14106's current affinity list: 0,1
pid 14106's new affinity list: 0
root@iZf8z0awjk4b1twtysjcdaZ:~# taskset -cp 1 5462
pid 5462's current affinity list: 0,1
pid 5462's new affinity list: 1
root@iZf8z0awjk4b1twtysjcdaZ:~# ps -eo pid,args,psr|grep xmrig
 5462 ./xmrig                       1
14106 ./xmrig --cpu-affinity=0      0
```







æ¢é•œåƒä¹‹åï¼Œ

docker pull 172.16.2.40:5000/ad_ubuntu:5.0

40æ‰‹åŠ¨æ‹‰é•œåƒ

docker rm -f child

docker rm 172.16.2.40:5000/ad_ubuntu:5.0

docker pull localhost:5000/ad_ubuntu:5.0

docer tag localhost:5000/ad_ubuntu:5.0 



# ä¿®æ”¹é•œåƒæµç¨‹

- ç‰ˆæœ¬å·æ˜¯å¦å˜åŒ–ï¼Ÿ
  - å¦‚æœç‰ˆæœ¬å·versionå‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦ä¿®æ”¹to_child/main_control_docker.shä¸­çš„version
  - é‡æ–°å‘å¸ƒto_child/main_control_docker.sh

- å¯åŠ¨ä¿®æ”¹å®¹å™¨
  - docker stop modify
  - docker rm modify
  - docker run -itd --name modify 172.16.2.41:5000/ad_ubuntu:${old_version} /bin/bash
  - docker attach modify
    - å¼€å§‹ä¿®æ”¹
  - å®¹å™¨å¤–ï¼Œå°†æ–‡ä»¶åŒ…å¤åˆ¶åˆ°å®¹å™¨ä¸­
    - docker cp /child.tar modify:/home
    - docker cp /main_control.tar modify:/home
  - è¿›å…¥å®¹å™¨è§£å‹
    - docker attach modify
    - cd /home && tar -xf child.tar && tar -xf main_control.tar
- ä¿å­˜é•œåƒï¼Œç‰ˆæœ¬å·å¯èƒ½æ›´æ–°
  - docker commit modify 172.16.2.41:5000/ad_ubuntu:${version}
- pushåˆ°ç§æœ‰ä»“åº“
  - docker push 172.16.2.41:5000/ad_ubuntu:${version}

- æ‰€æœ‰æœºå™¨ä¿®æ”¹è„šæœ¬æ‰§è¡Œæƒé™
  - cd / && chmod 744 to_child_docker.sh && chmod 744 to_main_control_docker.sh && ./to_child_docker.sh

- 41è¿™å°æœºå™¨ï¼Œæ‹‰é•œåƒå¾—ç”¨localhost

  - ```bash
    version='6.0'
    kill -9 $(lsof -t -i:8001)
    docker start child
    docker stop child
    docker rm -f child
    docker pull localhost:5000/ad_ubuntu:${version}
    docker run -itd --name child -p 8001:8001 -v /root:/root localhost:5000/ad_ubuntu:${version} /bin/bash
    docker exec -d child /bin/bash /start_child.sh
    ```

  - 
  
- è¿›å…¥55æ‰§è¡Œmain_controlè„šæœ¬
  - cd / && ./to_main_control_docker.sh

# å‘é‚®ä»¶æŠ¥é”™

## å®¹å™¨å¤–



### å‘é€çš„ä¿¡æ¯

åœ¨å®¹å™¨å¤–ï¼Œå¦‚æœæ£€æŸ¥åˆ°å®¹å™¨åœæ­¢äº†ï¼Œéœ€è¦å‘é‚®ä»¶

- å“ªå°æœºå™¨
  - ï¼ˆipåœ°å€ï¼‰
- å“ªä¸ªå®¹å™¨
  - æ˜¯childè¿˜æ˜¯main_control
- å†™æ—¥å¿—
  - /root/child.txtæˆ–è€…æ˜¯/root/main_control.txt



### ä»£ç 

```bash
# -*- coding: utf-8 -*-
import datetime
import smtplib
from email.mime.text import MIMEText
from email.utils import formataddr
from email.mime.multipart import MIMEMultipart
import os
import time

# ç›‘æµ‹childå®¹å™¨æ˜¯å¦è¿è¡Œ

# å½“å‰è¿è¡Œæœºå™¨çš„ipåœ°å€
def get_ip():
    r = os.popen(r"ip address |sed -rn '/state UP/{n;n;s#^ *inet (.*)/.*$#\1#gp}'").read().split('\n')
    return r[0]

# æŒ‡æ˜ipï¼Œå®¹å™¨åï¼ŒåŸå› æ˜¯å®¹å™¨åœæ­¢äº†
def send_email(container_name):
    sender = 'whr15266981370@163.com'
    receive = '819987540@qq.com'
    passwd = 'PJOTYCRDJDGVLBLQ' # æˆæƒç python3
    mailserver = 'smtp.163.com'
    port = '465'
    local_ip = get_ip()
    subject = f'å¹¿å‘Šé¡¹ç›®å®¹å™¨æŒ‚æ‰ï¼Œipï¼š{local_ip}ï¼Œå®¹å™¨åï¼š{container_name}'

    msg = MIMEMultipart('related')
    msg['From'] = formataddr(["å¹¿å‘Šé¡¹ç›®", sender])
    msg['To'] = formataddr(["2190300211ç‹æµ©ç„¶", receive])
    msg['Subject'] = subject

    txt = MIMEText('èµ¶ç´§æ¥ä¿®å¤å§ï¼', 'plain', 'utf-8')
    msg.attach(txt)


    server = smtplib.SMTP_SSL(mailserver, port)
    server.login(sender, passwd)
    server.sendmail(sender, receive, msg.as_string())
    server.quit()

# å°†å‘é‚®ä»¶è¿™ä¸ªåŠ¨ä½œè®°å½•åˆ°/rootæ—¥å¿—
def send_email_log(container_name):
    with open(f'/root/{container_name}.txt','a',encoding='utf8') as f:
        now_time = datetime.datetime.now().strftime(('%Y-%m-%d-%H-%M-%S'))
        f.write(f'{now_time}-ç›‘æµ‹åˆ°-{container_name}-æŒ‚æ‰\n')

if __name__ == '__main__':
    while 1:
        res = os.popen('docker ps --format "{{.Names}}"').read().split('\n')
        container_names = ['child']
        for container_name in container_names:
            if container_name not in res:
                send_email_log(container_name)
                send_email(container_name)
        # æ¯éš”ååˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        time.sleep(60*10)
```



### éƒ¨ç½²

```bash
# å°† track_child_container_status.py track_main_control_container_status.py 
# æ”¾åˆ°æ‰€æœ‰æœºå™¨çš„ / ä¸‹é¢

# æ”¾åˆ°to_child_containe.shä¸­æœ€åæ‰§è¡Œ
cd / && nohup python3 -u track_child_container_status.py &

# æ”¾åˆ°to_main_control_containe.shä¸­æœ€åæ‰§è¡Œ
cd / && nohup python3 -u track_main_control_container_status.py &
```



## å®¹å™¨å†…

### ç­–ç•¥

ä»ç»“æœæ¥çœ‹

- imgå’Œhtmlæ–‡ä»¶å¤¹ä¸‹å¦‚æœè¶…è¿‡1Gï¼Œåˆ™è‡ªåŠ¨æ¸…ç†
- å¦‚æœres.txtæ–‡ä»¶è¶…è¿‡ä¸‰å°æ—¶æ²¡æ›´æ–°ï¼Œåˆ™åº”è¯¥å‘é‚®ä»¶
- å¦‚æœres.txtæ–‡ä»¶è¶…è¿‡1Gï¼Œåˆ™è‡ªåŠ¨æ¸…ç†



### ä»£ç 

track_img_html_res_status.py

```python
# -*- coding: utf-8 -*-

# æœ¬ä»£ç æ¯éš”åäºŒå°æ—¶æ‰§è¡Œä¸€æ¬¡

# å¯¹äºchild
# - imgå’Œhtmlæ–‡ä»¶å¤¹ä¸‹å¦‚æœè¶…è¿‡1Gï¼Œåˆ™è‡ªåŠ¨æ¸…ç†
# - å¦‚æœres.txtæ–‡ä»¶è¶…è¿‡ä¸‰å°æ—¶æ²¡æ›´æ–°ï¼Œåˆ™åº”è¯¥å‘é‚®ä»¶
# - å¦‚æœres.txtæ–‡ä»¶è¶…è¿‡1Gï¼Œåˆ™è‡ªåŠ¨æ¸…ç†

import os,datetime
import smtplib
import time
from email.mime.text import MIMEText
from email.utils import formataddr
from email.mime.multipart import MIMEMultipart

def main(root_path):
    # å¯¹imgã€htmlç›®å½•è¿›è¡Œå¤§å°æ£€æŸ¥
    dir_names = ['img','html']
    for dir_name in dir_names:
        dir_path = f'{root_path}/{dir_name}'
        # åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
        if os.path.exists(dir_path):
            # æ–‡ä»¶å¤¹å¤§å°è¶…è¿‡1gï¼Œè¿›è¡Œåˆ é™¤
            if size_over_one_G(dir_path):
                res = os.popen(f'rm -rf {dir_path}/*').read()
                print(res)
                log(f'{dir_path}å†…å®¹è¶…è¿‡1Gï¼Œè‡ªåŠ¨æ¸…ç†')
        # æ–°å»ºæ–‡ä»¶å¤¹
        else:
            os.mkdir(dir_path)

    # å¯¹res.txtè¿›è¡Œå¤§å°æ£€æŸ¥å’Œæ—¥æœŸæ£€æŸ¥
    file_name = 'res.txt'
    file_path = f'{root_path}/{file_name}'
    if os.path.exists(file_path):
        # è·ç¦»ä¸Šæ¬¡æ–‡ä»¶æ›´æ–°æ—¶é—´è¶…è¿‡ä¸‰ä¸ªå°æ—¶ï¼Œå‘é€é‚®ä»¶
        if file_date_over_three_hour(file_path):
            send_email()
            log('res.txtæ—¥å¿—æ–‡ä»¶è¶…è¿‡ä¸‰å°æ—¶æœªæ›´æ–°')
        if size_over_one_G(file_path):
            # è¶…è¿‡1Gï¼Œæ¸…é™¤ä¹‹
            res = os.popen(f'rm -rf {file_path}').read()
            print(res)
            log('res.txtè¶…è¿‡1Gï¼Œè‡ªåŠ¨æ¸…ç†')
    else:
        f = open(f'{file_path}','w')
        f.close()

# å½“å‰è¿è¡Œæœºå™¨çš„ipåœ°å€
def get_ip():
    r = os.popen(r"ip address |sed -rn '/state UP/{n;n;s#^ *inet (.*)/.*$#\1#gp}'").read().split('\n')
    return r[0]

# æŒ‡æ˜ipï¼Œå®¹å™¨åï¼ŒåŸå› æ˜¯å®¹å™¨res.txtè¶…è¿‡ä¸‰å°æ—¶æœªæ›´æ–°
def send_email():
    sender = 'whr15266981370@163.com'
    receive = '819987540@qq.com'
    passwd = 'PJOTYCRDJDGVLBLQ' # æˆæƒç python3
    mailserver = 'smtp.163.com'
    port = '465'
    local_ip = get_ip()
    subject = f'å¹¿å‘Šé¡¹ç›®ï¼Œipï¼š{local_ip}ï¼Œå®¹å™¨ï¼šchildï¼Œres.txtè¶…è¿‡ä¸‰ä¸ªå°æ—¶æœªæ›´æ–°'

    msg = MIMEMultipart('related')
    msg['From'] = formataddr(["å¹¿å‘Šé¡¹ç›®", sender])
    msg['To'] = formataddr(["2190300211ç‹æµ©ç„¶", receive])
    msg['Subject'] = subject

    txt = MIMEText('èµ¶ç´§æ¥ä¿®å¤å§ï¼', 'plain', 'utf-8')
    msg.attach(txt)


    server = smtplib.SMTP_SSL(mailserver, port)
    server.login(sender, passwd)
    server.sendmail(sender, receive, msg.as_string())
    server.quit()

# å°†å‘é‚®ä»¶è¿™ä¸ªåŠ¨ä½œè®°å½•åˆ°/rootæ—¥å¿—
def log(content):
    with open('/root/child.txt','a',encoding='utf8') as f:
        now_time = datetime.datetime.now().strftime(('%Y-%m-%d-%H-%M-%S'))
        f.write(f'{now_time}-ç›‘æµ‹åˆ°-child-{content}\n')

# æ–‡ä»¶ä¿®æ”¹æ—¶é—´è¶…è¿‡ä¸‰å°æ—¶
def file_date_over_three_hour(file_path):
    file_mtime = os.popen(f"ls -l --time-style '+%Y/%m/%d %H:%M:%S' {file_path}").read().split()[-3:-1]
    file_mtime = ' '.join(file_mtime)
    file_mtime = datetime.datetime.strptime(file_mtime,'%Y/%m/%d %H:%M:%S')

    now_time = datetime.datetime.now()

    gap_in_seconds = (now_time-file_mtime).seconds
    gap_in_days = (now_time-file_mtime).days

    # è¶…è¿‡ä¸€ä¸ªå°æ—¶æˆ–è¶…è¿‡ä¸€å¤©
    if gap_in_seconds > 3*60*60 or gap_in_days:
        return True
    else:
        return False

# æ–‡ä»¶/æ–‡ä»¶å¤¹å†…å®¹è¶…è¿‡1G
def size_over_one_G(path):
    res = os.popen(f'du -h --max-depth 1 {path}').read().split()[0]
    if res.endswith('G'):
        res = float(res.split('G')[0])
        if res > 1:
            # æ–‡ä»¶å¤¹å¤§å°è¶…è¿‡1gï¼Œè¿›è¡Œåˆ é™¤
            return True
    return False

if __name__ == '__main__':
    while 1:
        main('/home/child_no_log')
        time.sleep(12*60*60)
```



### éƒ¨ç½²

å°†track_img_html_res_status.pyæ”¾åˆ°/home/child_no_log/ç›®å½•ä¸‹

ä¿®æ”¹start_childr.shï¼šåŠ ä¸Šä¸€ä¸ªåå°è¿è¡Œçš„pythonç¨‹åº

```bash
cd /home/child_no_log
kill -9 $(lsof -t -i:8001)
nohup python3 -u main.py > res.txt &
nohup python3 -u track_img_html_res_status.py > log.txt &
```





## åˆ©ç”¨supervisorä¿è¯å‘é‚®ä»¶çš„ç¨‹åºä¸€ç›´æ‰§è¡Œ

### æµ‹è¯•

#### å®‰è£…

```bash
# å®‰è£…
apt update && apt -y install supervisor
# é…ç½®æ–‡ä»¶
# åœ¨/etc/supervisorç›®å½•ä¸‹
root@3bc427bb99a2:/etc/supervisor# tree -L 2
.
|-- conf.d
`-- supervisord.conf

# é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸ºsupervisord.conf
# æ¯è¡Œä¸­ç”¨ ';',è¡¨ç¤ºæ³¨é‡Šå­—ç¬¦ä¸²
```



#### é…ç½®

```bash
root@3bc427bb99a2:/etc/supervisor# cat supervisord.conf 
; supervisor config file

[unix_http_server]
file=/var/run/supervisor.sock   ; (the path to the socket file)
chmod=0700                       ; sockef file mode (default 0700)

[supervisord]
# è®°å½•supervisordçš„è¿è¡Œæ—¥å¿—
logfile=/etc/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)
pidfile=/etc/supervisor/supervisord.pid ; (supervisord pidfile;default supervisord.pid)
# ç¨‹åºçš„æ—¥å¿—æ–‡ä»¶
childlogdir=/etc/supervisor/log            ; ('AUTO' child log dir, default $TEMP)

; the below section must remain in the config file for RPC
; (supervisorctl/web interface) to work, additional interfaces may be
; added by defining them in separate rpcinterface: sections
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket

; The [include] section can just contain the "files" setting.  This
; setting can list multiple files (separated by whitespace or
; newlines).  It can also contain wildcards.  The filenames are
; interpreted as relative to this file.  Included files *cannot*
; include files themselves.

# è¿è¡Œç¨‹åºçš„é…ç½®æ–‡ä»¶
[include]
files = /etc/supervisor/conf.d/*.conf
```



```bash
# /root/test.sh
root@3bc427bb99a2:/etc/supervisor# cat /root/test.sh 
while true;do
	let n++
	echo $n >> /root/log.txt
done
root@3bc427bb99a2:/etc/supervisor/conf.d# cat test.conf 
[program:test]
command=/bin/bash /root/test.sh ; ç¨‹åºå¯åŠ¨å‘½ä»¤
autostart=true       ; åœ¨supervisordå¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨
startsecs=10         ; å¯åŠ¨10ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±è¡¨ç¤ºè¿›ç¨‹æ­£å¸¸å¯åŠ¨äº†ï¼Œé»˜è®¤ä¸º1ç§’
autorestart=true     ; ç¨‹åºé€€å‡ºåè‡ªåŠ¨é‡å¯,å¯é€‰å€¼ï¼š[unexpected,true,false]ï¼Œé»˜è®¤ä¸ºunexpectedï¼Œè¡¨ç¤ºè¿›ç¨‹æ„å¤–æ€æ­»åæ‰é‡å¯
startretries=5       ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯3
user=root        ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨è¿›ç¨‹ï¼Œé»˜è®¤æ˜¯root
priority=999         ; è¿›ç¨‹å¯åŠ¨ä¼˜å…ˆçº§ï¼Œé»˜è®¤999ï¼Œå€¼å°çš„ä¼˜å…ˆå¯åŠ¨
redirect_stderr=true ; æŠŠstderré‡å®šå‘åˆ°stdoutï¼Œé»˜è®¤false
stdout_logfile_maxbytes=20MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤50MB
stdout_logfile_backups = 20   ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°ï¼Œé»˜è®¤æ˜¯10
; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰
stdout_logfile=/root/test.log
stopasgroup=false     ;é»˜è®¤ä¸ºfalse,è¿›ç¨‹è¢«æ€æ­»æ—¶ï¼Œæ˜¯å¦å‘è¿™ä¸ªè¿›ç¨‹ç»„å‘é€stopä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹
killasgroup=false     ;é»˜è®¤ä¸ºfalseï¼Œå‘è¿›ç¨‹ç»„å‘é€killä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹
```



#### è¿è¡Œæµ‹è¯•

```bash
# è½½å…¥é…ç½®æ–‡ä»¶
supervisord -c /etc/supervisor/supervisord.conf
root@3bc427bb99a2:/etc/supervisor# supervisord -c /etc/supervisor/supervisord.conf

# /bin/bash /root/test.shå¼€å§‹è¿è¡Œ
root@3bc427bb99a2:/etc/supervisor# ll /root/
total 7120
-rw-r--r-- 1 root root 7262240 Sep 29 14:53 log.txt
-rw-r--r-- 1 root root       0 Sep 29 14:53 test.log
-rw-r--r-- 1 root root      55 Sep 29 14:43 test.sh
root@3bc427bb99a2:/etc/supervisor# ll /root/
total 8144
-rw-r--r-- 1 root root 8312464 Sep 29 14:53 log.txt
-rw-r--r-- 1 root root       0 Sep 29 14:53 test.log
-rw-r--r-- 1 root root      55 Sep 29 14:43 test.sh

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„ç¨‹åº
root@3bc427bb99a2:/etc/supervisor# supervisorctl status
test                             RUNNING   pid 826, uptime 0:01:10
root@3bc427bb99a2:/etc/supervisor# supervisorctl status
test                             RUNNING   pid 826, uptime 0:01:18

# æ—¥å¿—æ–‡ä»¶
root@3bc427bb99a2:/etc/supervisor# cat supervisord.log
2021-09-29 14:53:30,180 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
2021-09-29 14:53:30,180 INFO Included extra file "/etc/supervisor/conf.d/test.conf" during parsing
2021-09-29 14:53:30,183 INFO RPC interface 'supervisor' initialized
2021-09-29 14:53:30,183 CRIT Server 'unix_http_server' running without any HTTP authentication checking
2021-09-29 14:53:30,185 INFO daemonizing the supervisord process
2021-09-29 14:53:30,185 INFO supervisord started with pid 825
2021-09-29 14:53:31,188 INFO spawned: 'test' with pid 826
2021-09-29 14:53:41,199 INFO success: test entered RUNNING state, process has stayed up for > than 10 seconds (startsecs)

# åœæ­¢testé¡¹ç›®
root@3bc427bb99a2:/etc/supervisor# supervisorctl stop test
test: stopped
root@3bc427bb99a2:/etc/supervisor# cat supervisord.log
2021-09-29 14:53:30,180 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
2021-09-29 14:53:30,180 INFO Included extra file "/etc/supervisor/conf.d/test.conf" during parsing
2021-09-29 14:53:30,183 INFO RPC interface 'supervisor' initialized
2021-09-29 14:53:30,183 CRIT Server 'unix_http_server' running without any HTTP authentication checking
2021-09-29 14:53:30,185 INFO daemonizing the supervisord process
2021-09-29 14:53:30,185 INFO supervisord started with pid 825
2021-09-29 14:53:31,188 INFO spawned: 'test' with pid 826
2021-09-29 14:53:41,199 INFO success: test entered RUNNING state, process has stayed up for > than 10 seconds (startsecs)
2021-09-29 14:55:23,181 INFO waiting for test to stop
2021-09-29 14:55:23,186 INFO stopped: test (terminated by SIGTERM)

# ä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
root@3bc427bb99a2:/etc/supervisor# supervisorctl reload
Restarted supervisord
root@3bc427bb99a2:/etc/supervisor# cat supervisord.pid 
825

# æµ‹è¯•supervisoræ˜¯å¦èƒ½æ‹‰èµ·æ¥test.sh
root@3bc427bb99a2:/etc/supervisor# ll /root
total 154040
drwx------ 1 root root      4096 Sep 29 14:56 ./
drwxr-xr-x 1 root root      4096 Sep 29 14:36 ../
-rw-r--r-- 1 root root      3106 Dec  5  2019 .bashrc
-rw-r--r-- 1 root root       161 Dec  5  2019 .profile
-rw------- 1 root root      4390 Sep 29 14:56 .viminfo
-rw-r--r-- 1 root root 157700314 Sep 29 15:00 log.txt
-rw-r--r-- 1 root root         0 Sep 29 14:53 test.log
-rw-r--r-- 1 root root        55 Sep 29 14:43 test.sh
root@3bc427bb99a2:/etc/supervisor# ps -aux|grep bash
root           1  0.0  0.1   4232  3508 pts/0    Ss   14:36   0:00 /bin/bash
root         839 98.2  0.1   4204  3088 ?        R    14:56   4:09 /bin/bash /root/test.sh
root         849  0.0  0.0   3304   740 pts/0    S+   15:00   0:00 grep --color=auto bash
root@3bc427bb99a2:/etc/supervisor# kill -9 839
root@3bc427bb99a2:/etc/supervisor# ps -aux|grep bash
root           1  0.0  0.1   4232  3508 pts/0    Ss   14:36   0:00 /bin/bash
root         851  0.0  0.0   3304   672 pts/0    S+   15:00   0:00 grep --color=auto bash
root@3bc427bb99a2:/etc/supervisor# ps -aux|grep bash
root           1  0.0  0.1   4232  3524 pts/0    Ss   14:36   0:00 /bin/bash
root         852 84.8  0.1   4204  3172 ?        R    15:00   0:05 /bin/bash /root/test.sh
root         854  0.0  0.0   3304   736 pts/0    S+   15:00   0:00 grep --color=auto bash
root@3bc427bb99a2:/etc/supervisor# cat supervisord.log 
2021-09-29 14:56:12,416 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.
2021-09-29 14:56:12,416 INFO Included extra file "/etc/supervisor/conf.d/test.conf" during parsing
2021-09-29 14:56:12,416 INFO RPC interface 'supervisor' initialized
2021-09-29 14:56:12,416 CRIT Server 'unix_http_server' running without any HTTP authentication checking
2021-09-29 14:56:12,416 INFO supervisord started with pid 825
2021-09-29 14:56:13,419 INFO spawned: 'test' with pid 839
2021-09-29 14:56:23,429 INFO success: test entered RUNNING state, process has stayed up for > than 10 seconds (startsecs)
2021-09-29 15:00:36,690 INFO exited: test (terminated by SIGKILL; not expected)
2021-09-29 15:00:37,693 INFO spawned: 'test' with pid 852
2021-09-29 15:00:47,707 INFO success: test entered RUNNING state, process has stayed up for > than 10 seconds (startsecs)
```





### é…ç½®æ–‡ä»¶çš„è§£é‡Š

```bash
[unix_http_server]
file=/tmp/supervisor.sock   ; UNIX socket æ–‡ä»¶ï¼Œsupervisorctl ä¼šä½¿ç”¨
;chmod=0700                 ; socket æ–‡ä»¶çš„ modeï¼Œé»˜è®¤æ˜¯ 0700
;chown=nobody:nogroup       ; socket æ–‡ä»¶çš„ ownerï¼Œæ ¼å¼ï¼š uid:gid

[supervisord]
logfile=/tmp/supervisord.log ; æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ $CWD/supervisord.log
logfile_maxbytes=50MB        ; æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºä¼š rotateï¼Œé»˜è®¤ 50MB
logfile_backups=10           ; æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤‡ä»½æ•°é‡é»˜è®¤ 10
loglevel=info                ; æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ infoï¼Œå…¶å®ƒ: debug,warn,trace
pidfile=/tmp/supervisord.pid ; pid æ–‡ä»¶
nodaemon=false               ; æ˜¯å¦åœ¨å‰å°å¯åŠ¨ï¼Œé»˜è®¤æ˜¯ falseï¼Œå³ä»¥ daemon çš„æ–¹å¼å¯åŠ¨
minfds=1024                  ; å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°å€¼ï¼Œé»˜è®¤ 1024
minprocs=200                 ; å¯ä»¥æ‰“å¼€çš„è¿›ç¨‹æ•°çš„æœ€å°å€¼ï¼Œé»˜è®¤ 200
  
; the below section must remain in the config file for RPC
; (supervisorctl/web interface) to work, additional interfaces may be
; added by defining them in separate rpcinterface: sections
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
  
[supervisorctl]
serverurl=unix:///tmp/supervisor.sock ; é€šè¿‡ UNIX socket è¿æ¥ supervisordï¼Œè·¯å¾„ä¸ unix_http_server éƒ¨åˆ†çš„ file ä¸€è‡´
;serverurl=http://127.0.0.1:9001 ; é€šè¿‡ HTTP çš„æ–¹å¼è¿æ¥ supervisord
  
; åŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶
[include]
files = relative/directory/*.conf   ; å¯ä»¥æ˜¯ *.conf æˆ– *.ini

; [program:xx]æ˜¯è¢«ç®¡ç†çš„è¿›ç¨‹é…ç½®å‚æ•°ï¼Œxxæ˜¯è¿›ç¨‹çš„åç§°
[program:xx]
command=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; ç¨‹åºå¯åŠ¨å‘½ä»¤
autostart=true       ; åœ¨supervisordå¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨
startsecs=10         ; å¯åŠ¨10ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±è¡¨ç¤ºè¿›ç¨‹æ­£å¸¸å¯åŠ¨äº†ï¼Œé»˜è®¤ä¸º1ç§’
autorestart=true     ; ç¨‹åºé€€å‡ºåè‡ªåŠ¨é‡å¯,å¯é€‰å€¼ï¼š[unexpected,true,false]ï¼Œé»˜è®¤ä¸ºunexpectedï¼Œè¡¨ç¤ºè¿›ç¨‹æ„å¤–æ€æ­»åæ‰é‡å¯
startretries=3       ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯3
user=tomcat          ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨è¿›ç¨‹ï¼Œé»˜è®¤æ˜¯root
priority=999         ; è¿›ç¨‹å¯åŠ¨ä¼˜å…ˆçº§ï¼Œé»˜è®¤999ï¼Œå€¼å°çš„ä¼˜å…ˆå¯åŠ¨
redirect_stderr=true ; æŠŠstderré‡å®šå‘åˆ°stdoutï¼Œé»˜è®¤false
stdout_logfile_maxbytes=20MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤50MB
stdout_logfile_backups = 20   ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°ï¼Œé»˜è®¤æ˜¯10
; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰
stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out
stopasgroup=false     ;é»˜è®¤ä¸ºfalse,è¿›ç¨‹è¢«æ€æ­»æ—¶ï¼Œæ˜¯å¦å‘è¿™ä¸ªè¿›ç¨‹ç»„å‘é€stopä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹
killasgroup=false     ;é»˜è®¤ä¸ºfalseï¼Œå‘è¿›ç¨‹ç»„å‘é€killä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹
```



### æ§åˆ¶å‘½ä»¤

```bash
# åŠ è½½é…ç½®æ–‡ä»¶
supervisord -c /etc/supervisord/supervisord.fonc
# å¦‚æœæŠ¥é”™ï¼š
# ps -aux|grep supervisord ï¼Œæ€æ‰ç›¸åº”è¿›ç¨‹ï¼Œé‡è¯•

# æ‰€æœ‰é¡¹ç›®
supervisorctl statusï¼šæŸ¥çœ‹æ‰€æœ‰é¡¹ç›®è¿›ç¨‹çš„çŠ¶æ€
supervisorctl reload: é‡æ–°å¯åŠ¨é…ç½®ä¸­çš„æ‰€æœ‰ç¨‹åº

# æŸä¸ªé¡¹ç›®
supervisorctl stop esï¼šåœæ­¢es
supervisorctl start esï¼šå¯åŠ¨es
supervisorctl restart es: é‡å¯es
supervisorctl update ï¼šé…ç½®æ–‡ä»¶ä¿®æ”¹åå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤åŠ è½½æ–°çš„é…ç½®
```



### ä¿è¯é‚®ä»¶å‘é€ç¨‹åºä¸æŒ‚æ‰

#### å®¹å™¨å¤–

```bash
# å®‰è£…supervisorï¼Œåˆ é™¤é»˜è®¤çš„é…ç½®æ–‡ä»¶
apt update && apt -y install supervisor && rm -rf /etc/supervisor

# å†™å¥½çš„é…ç½®æ–‡ä»¶åˆ†ä¸ºchildå’Œmain_controlä¸¤ä¸ª
# 55ä»¥å¤–çš„æœºå™¨ä¸Šã€å®¹å™¨å¤–ï¼Œåªæœ‰childï¼›55ä¸Šæœ‰childå’Œmain

# å°†å†™å¥½çš„supervisor/ç§»åˆ°/etcç›®å½•ä¸‹
mv /supervisor /etc/

# åŠ è½½é…ç½®æ–‡ä»¶
supervisord -c /etc/supervisor/out_container.conf

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
supervisorctl status
```





#### å®¹å™¨å†…

```bash
# å®‰è£…supervisor
rm -rf /etc/supervisor
å°†å†™å¥½çš„supervisor/ç§»åˆ°/etcç›®å½•ä¸‹
mv /supervisor /etc/

# ä¿®æ”¹start_child.shå’Œstart_main_control.sh
supervisord -c /etc/supervisor/in_container.conf

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
supervisorctl status
```







### é—®é¢˜

- supervisorä¸èƒ½ç®¡ç†åå°è¿›ç¨‹ï¼Œæ‰€ä»¥è¿è¡Œçš„commandä¸€æ–¹é¢ä¸èƒ½è½¬åˆ°åå°è¿è¡Œï¼Œå¦ä¸€æ–¹é¢ä¸èƒ½åŠ å®ˆæŠ¤è¿›ç¨‹ï¼ˆä¸è¿‡å¦‚æœåŠ äº†æœåŠ¡ï¼Œä¹Ÿæ²¡å¿…è¦ç”¨supervisorï¼‰

```bash
commandä¸­æŒ‡å®šçš„è¿›ç¨‹å·²ç»èµ·æ¥ï¼Œä½†supervisorè¿˜ä¸æ–­é‡å¯

     é—®é¢˜æè¿°ï¼šcommandä¸­å¯åŠ¨æ–¹å¼ä¸ºåå°å¯åŠ¨ï¼Œå¯¼è‡´è¯†åˆ«ä¸åˆ°pidï¼Œç„¶åä¸æ–­é‡å¯ï¼Œæœ¬äººä½¿ç”¨çš„æ˜¯elasticsearchï¼Œcommand                        æŒ‡å®šçš„æ˜¯$path/bin/elasticsearch -dï¼Œè¸©åˆ°çš„å‘

     è§£å†³åŠæ³•ï¼šsupervisoræ— æ³•æ£€æµ‹åå°å¯åŠ¨è¿›ç¨‹çš„pidï¼Œè€Œsupervisoræœ¬èº«å°±æ˜¯åå°å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒè¿™ä¸ª

command = /usr/local/nginx/sbin/nginx ç»“æœå°±ä¸€ç›´å¯åŠ¨nginx å› ä¸ºè¿™æ ·çš„è¯ æ˜¯åå°è¿è¡Œçš„nginxï¼Œç„¶è€Œsupervisor ä¸èƒ½ç®¡ç†åå°è¿è¡Œè¿›ç¨‹ï¼Œæ‰€ä»¥æŠŠnginx daemon off å®ˆæŠ¤å…³æ‰ï¼Œå°±è®©ä»–é˜»å¡åœ¨å‰å°bashè¿è¡Œï¼Œæ–¹ä¾¿supervisoræ¥ç®¡ç†ã€‚
åº”è¯¥æ˜¯command = /usr/local/nginx/sbin/nginx -g 'daemon off'
```



# å£å­å“¥éƒ¨ç½²

https://www.kouzige.cn/

## å­—æ®µ

### å‘ç°é¡µ

- æ€»é¡µæ•°

  - div class="pagination clearfix"
    - span /

- li class="item"

- èˆ†æƒ…åŸºæœ¬å±æ€§

  - å‘å¸ƒæ—¶é—´
    - span class="item-meta-li date" 
      - åˆ†é’Ÿå‰
      - å°æ—¶å‰
      - å¤©å‰
      - æ—¥æœŸï¼Œ2021å¹´8æœˆ16æ—¥
  - é˜…è¯»é‡
    - span class="item-meta-li views"
  - ç‚¹èµé‡
    - span class="item-meta-li likes"
  - url a href

```bash
{'release_time': '2021å¹´08æœˆ31æ—¥', 'read_times': '34.8K', 'thumbs_up': '0', 'target_page_url': 'https://www.kouzige.cn/54919.html', 'img': 'iVBORw0KGgoAAAANSUhEUgAAAroAAACnCAYAAAD+Kv91AAAAAXNSR0IArs4c6QAAIABJREFUeJzsvVtsHFma3
```



### è¯¦æƒ…é¡µ

- div class="entry"
- èˆ†æƒ…æ ‡é¢˜
  - h1 class="entry-title"
- èˆ†æƒ…å†…å®¹
  - div class="entry-content clearfix"
- å£å­åç§°
  - p å£å­åç§°ï¼š
- ç”³è¯·å…¥å£
  - a rel="noopener noreferrer nofollow"
    - å¯èƒ½æ˜¯é“¾æ¥ï¼Œå¯èƒ½æ˜¯å¾®ä¿¡å°ç¨‹åºçš„äºŒç»´ç 
      - å¦‚æœæ˜¯é“¾æ¥ï¼Œå­˜é“¾æ¥
      - å¦‚æœä¸æ˜¯é“¾æ¥ï¼Œå­˜æ–‡æœ¬ï¼ˆæŒ‡ç¤ºä¿¡æ¯ï¼‰



### ç›®æ ‡é¡µ

- ç›®æ ‡é¡µæ ‡é¢˜
  - title
- ç›®æ ‡é¡µå¿«ç…§
  - æˆªå›¾ï¼Œbase64
- ç›®æ ‡é¡µé“¾æ¥
  - è·³è½¬åçš„é“¾æ¥



```bash
# ç»™é›†ç¾¤çš„å‘ç°é¡µä»»åŠ¡
	url:str
	tag:0,int
	release_city:str
# ä»é›†ç¾¤æ”¶åˆ°çš„å‘ç°é¡µæ•°æ®ï¼ˆä¸ºç©ºï¼Œè®¾ç½®ä¸ºNoneï¼‰
	html:str
	img:str
	
	# fake_url:str
	# real_url:str
	
	div_pos:list([[1,2,3,4],[]])
	tag:0,int
	release_city:str
	# time:2021-09-03
# å‘ç»™é›†ç¾¤çš„ç›®æ ‡é¡µä»»åŠ¡
	url:str(é€šè¿‡htmlè§£æå‡ºçš„è·³è½¬ä¹‹å‰çš„url)
	tag:1,int
	release_city:str
# ä»é›†ç¾¤æ”¶åˆ°çš„ç›®æ ‡é¡µæ•°æ®
	html:str
	img:str
	
	fake_url:strï¼Œä¹‹å‰ä¼ ç»™é›†ç¾¤çš„url
	real_url:strï¼Œè·³è½¬ä¹‹åçš„url
	
	# div_pos:list([[1,2,3,4],[]])
	tag:1,int
	release_city:str
	time:2021-09-03
# å­˜å…¥æ•°æ®åº“çš„å‘ç°é¡µ
	title:str
	description:str
	release_company:str
	release_city:str
	tags:[str,str...]
	img:str(base64)
# å­˜å…¥æ•°æ®åº“çš„ç›®æ ‡é¡µ
	title:str
	types:str
	manager_name:str
	company_location:str
	service_description:str
	release_city:str
	img:str
```





ipï¼š172.16.2.55:8005

å¯åŠ¨redis

```bash
docker pull redis:6.2.4-buster

docker run -itd --name kouzige_redis -p 6379:6379 redis:6.2.4-buster /bin/bash
cd 
# ä¿®æ”¹åå°è¿è¡Œ
redis-server ./redis.conf
# è¿›è¡Œè®¿é—®æµ‹è¯•
```





start_kouzige_create_docker.sh å ç”¨8005ç«¯å£

```bash
kill -9 $(lsof -t -i:8005)
cd /home/kouzige/
nohup python3 -u create_init_url.py > res.txt &
```



start_kouzige_child_docker.sh

```bash
cd /home/kouzige/
nohup python3 -u child_main.py > res.txt &
```



å¯åŠ¨createæ¨¡å—

```bash
docker stop kouzige_create
docker rm kouzige_create
docker run -itd --name  kouzige_create -v /root:/root -p 8005:8005 172.16.2.40:5000/kouzige:1.0 /bin/bash
docker exec -it kouzige_create /bin/bash /start_kouzige_create_docker.sh
```



å¯åŠ¨childæ¨¡å—

```bash
docker stop kouzige_child
docker rm kouzige_child
docker run -itd --name  kouzige_child -v /root:/root 172.16.2.40:5000/kouzige:1.0 /bin/bash
docker exec -it kouzige_create /bin/bash /start_kouzige_child_docker.sh
```





```bash
docker stop kouzige_create
docker rm kouzige_create
docker run -itd --name  kouzige_create -v /root:/root -p 8005:8005 172.16.2.40:5000/kouzige:1.0 /bin/bash

docker exec -it kouzige mkdir /home/kouzige
docker cp /kou_zi_ge.py kouzige:/home/kouzige/
docker cp /upload_kouzige.py kouzige:/home/kouzige/
docker cp /requirements.txt kouzige:/home/kouzige/
docker attach kouzige
cd /home/kouzige
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
nohup python3 -u kou_zi_ge.py > res.txt &
```





# redis

## å®‰è£…

è§ç³»ç»Ÿé•œåƒä¸€èŠ‚ï¼Œæ³¨æ„è®¾ç½®è½¯è¿æ¥ï¼Œæ–¹ä¾¿è®¿é—®ï¼Œå¹¶è®¾ç½®å®ˆæŠ¤è¿›ç¨‹ï¼Œè®©æœåŠ¡å™¨ç«¯åå°è¿è¡Œã€‚



## è¿æ¥

```python
# å¯¼å…¥åº“ 
import redis
# è¿æ¥redisæ•°æ®åº“
r = redis.StrictRedis(host='localhost',port=6379.db=0,decode_response=True)
# hostæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿æœ¬åœ°çš„ï¼Œä¹Ÿå¯ä»¥è¿è¿œç¨‹çš„ã€‚ï¼ˆåé¢æµ‹è¯•ä¸‹winè¿æœåŠ¡å™¨çš„ï¼‰
# ç«¯å£å·åœ¨æœåŠ¡å™¨ç«¯çš„é…ç½®æ–‡ä»¶ä¸­
# dbé»˜è®¤16ä¸ª
# é»˜è®¤decode_responsesä¸ºFalseï¼Œè¿”å›utf-8ç¼–ç åçš„å­—ç¬¦ä¸²

â€”â€”â€”â€”â€”â€”â€”â€”â€”æµ‹è¯•â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
import redis
r = redis.StrictRedis(host='localhost',port=6379,db=0)#,decode_responses=True)
r.set('key','ä½ å¥½')
a = r.get('key')
print(type(a))
print(a)
print(a.decode('utf8'))
<class 'bytes'>
b'\xe4\xbd\xa0\xe5\xa5\xbd'
ä½ å¥½

# å¦‚æœkeyå­˜åœ¨ï¼Œè¿”å›å…¶valueï¼ˆstrï¼‰
# å¯¹äºä¸å­˜åœ¨çš„keyï¼Œè¿”å› <class 'NoneType'>
# æ‰€ä»¥åˆ¤æ–­åº”è¯¥ç”¨ç±»å‹ï¼Œçœ‹æ˜¯ä¸æ˜¯str

â€”â€”â€”â€”â€”â€”â€”â€”â€”æµ‹è¯•â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
import redis
r = redis.StrictRedis(host='localhost',port=6379,db=0,decode_responses=True)
r.set('key',1)
a = r.get('ke')
if type(a) is str:
    print(a)
else:
    print('not')

b = r.get('key')
if type(b) is str:
    print(b)
else:
    print('not')
    
not
1
```



## è·å–æ‰€æœ‰çš„key

r.keys()è¿”å›æ‰€æœ‰çš„keyçš„åç§°ï¼Œç±»å‹ä¸ºåˆ—è¡¨ã€‚

å¯ä»¥ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚

```python
import redis
r = redis.StrictRedis(host='localhost',port=6379,db=0,decode_responses=True)
keys = r.keys()
print(keys)
['key', 'hmp']
```



## åˆ é™¤æ‰€æœ‰çš„key

r.delete(key_name/names)





pythonæ“ä½œredis

å¦‚æœæ²¡æœ‰æŸä¸ªkeyï¼Œè¿”å› `<class 'NoneType'>`ã€‚å¦åˆ™ï¼Œåœ¨è®¾ç½®äº†



# seleniumæˆªå›¾æ—¶ä¸­æ–‡å‡ºç°ä¹±ç 

 é“¾æ¥: [https://pan.baidu.com/s/1kqXoMo-mwhtgAn6_dXJQcg](https://links.jianshu.com/go?to=https%3A%2F%2Fpan.baidu.com%2Fs%2F1kqXoMo-mwhtgAn6_dXJQcg)  å¯†ç : a5c9

```bash
mkdir -p /usr/share/fonts/chinese/        #åˆ›å»ºä¸­æ–‡å­—ä½“ç›®å½•
cp songti.ttf /usr/share/fonts/chinese/     #å°†å­—ä½“æ–‡ä»¶æ‹·è´åˆ°/usr/share/fonts/chinese/ä¸­
cd /usr/share/fonts/chinese/
fc-cache -fv                              #ä¸ºåˆšåŠ å…¥çš„å­—ä½“è®¾ç½®ç¼“å­˜ä½¿ä¹‹æœ‰æ•ˆ
fc-list                                   #æŸ¥çœ‹ç³»ç»Ÿä¸­çš„å­—ä½“
```

lrange find_page_url_queue 0 100

lrange target_page_url_queue 0 100

lrange final_page_url_queue 0 100

llen find_page_url_queue

llen target_page_url_queue

llen final_page_url_queue



æ„é€ find_page_urlçš„æ¨¡å—å•ç‹¬æ‹¿å‡ºæ¥ï¼Œä¸²è¡Œå“åº”è¯·æ±‚ã€‚



# å¯¹å­˜å‚¨å›¾ç‰‡ã€htmlã€æ—¥å¿—çš„å¤„ç†

è£å‰ªæ—¶ï¼Œå›¾ç‰‡å…ˆä¿å­˜åœ¨æœ¬åœ°ï¼Œç„¶åè£å‰ª

- ç°åœ¨è£å‰ªåï¼Œåº”è¯¥é©¬ä¸ŠæŠŠå›¾ç‰‡åˆ é™¤ã€‚

å¯¹äºhtmlï¼Œä¸€å¼€å§‹æ˜¯åšæµ‹è¯•debugç”¨ã€‚

- ç°åœ¨ç›´æ¥ä¸å­˜äº†

å¯¹äºæ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•å†…å®¹ä¸å˜ï¼ˆçœ‹çœ‹æœ‰æ²¡æœ‰å¤šå­˜çš„ï¼Œæ¯”å¦‚æ‰“å°å›¾ç‰‡ï¼Œå¤ªå ç”¨ç©ºé—´äº†ï¼‰

- ç°åœ¨æ”¹ä¸ºä¸ƒå¤©æ¸…ç©ºä¸€æ¬¡æ—¥å¿—æ–‡ä»¶

logæ¨¡å—ï¼Œåªè®°å½•æ²¡æœ‰æˆåŠŸåˆ é™¤çš„æƒ…å†µ



du -h --max-depth=1



# dockerå¯åŠ¨æ—¶ç«¯å£æ˜ å°„é”™è¯¯

é‡å¯dockeræœåŠ¡ï¼Œç„¶åé‡å¯æŸä¸ªå®¹å™¨

```bash
systemctl restart docker
docker restart child main_control
```



# æ—¥å¿—è®°å½•

```bash
# é¦–å…ˆåœ¨è°ƒç”¨loggingæ¨¡å—æ—¶ï¼Œéœ€è¦é…ç½®ä¸€ä¸‹æ—¥å¿—è®°å½•çš„æ ¼å¼ã€æ—¥å¿—æ–‡ä»¶çš„ä½å­ï¼Œæ‰€ä»¥å»ºè®®åœ¨å…¥å£å‡½æ•°é‡Œé¢é…ç½®loggingæ¨¡å—

```



# æµ‹è¯•æœ€ç»ˆç‰ˆ

- å°†é•œåƒç‰ˆæœ¬å‡çº§ä¸º6.0
  - éœ€è¦å°†å¯åŠ¨å®¹å™¨çš„è„šæœ¬è¿›è¡Œä¿®æ”¹ï¼Œç„¶åå‘å¸ƒåˆ°æ‰€æœ‰æœºå™¨ä¸Š
- å°†55ï¼šmain_controlçš„cluserç«¯å£ä¸´æ—¶æ”¹ä¸º8080
- åœ¨54ä¸Šå…³é—­ä¹‹å‰çš„childï¼Œéƒ¨ç½²ä¸€ä¸ªchildï¼ˆ6.0ï¼‰





# ç¼–è¯‘è¿‡ç¨‹

[(9æ¡æ¶ˆæ¯) gccç¼–è¯‘å·¥å…·å¸¸ç”¨å‘½ä»¤ä»¥åŠæ±‡ç¼–è¯­è¨€_MSYçš„åšå®¢-CSDNåšå®¢_gccç¼–è¯‘å‘½ä»¤](https://blog.csdn.net/qq_44644740/article/details/109086520)



# pythonæ–‡ä»¶/æ–‡ä»¶å¤¹



## åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹

os.path.isfile(path)ï¼Œå¦‚æœpathå­˜åœ¨ä¸”æ˜¯æ–‡ä»¶ï¼Œè¿”å›Trueï¼›ä¸å­˜åœ¨æˆ–å­˜åœ¨ä½†ä¸ºæ–‡ä»¶å¤¹è¿”å›Falseã€‚

![image-20210927222224676](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927222224676.png)



os.path.isdir(path)

å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶å¤¹ï¼Œè¿”å›Trueï¼›ä¸å­˜åœ¨æˆ–å­˜åœ¨ä½†ä¸ºæ–‡ä»¶ï¼Œè¿”å›Falseã€‚

![image-20210927224233847](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927224233847.png)







## æ–‡ä»¶



### å­˜åœ¨åˆ¤æ–­

os.path.exists(path)ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ã€‚

ä¸åŒºåˆ†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚

![image-20210927222358123](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927222358123.png)





### åˆ›å»º

open

![image-20210927224029986](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927224029986.png)





### åˆ é™¤

os.remove(path)

æ–‡ä»¶å­˜åœ¨

![image-20210927223454207](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927223454207.png)



æ–‡ä»¶ä¸å­˜åœ¨

![image-20210927223956560](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927223956560.png)



### æ–‡ä»¶çš„æ‰©å±•å

os.path.splitext(file_name)ï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œï¼ˆæ–‡ä»¶åï¼Œæ–‡ä»¶çš„æ‰©å±•åï¼‰

![image-20210928160758260](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928160758260.png)









## æ–‡ä»¶å¤¹

### å­˜åœ¨åˆ¤æ–­

os.path.exists(path)



### åˆ›å»ºä¸€ä¸ªç›®å½•

![image-20210927225200127](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927225200127.png)



å¦‚æœå’Œæ–‡ä»¶å¤¹å‘½åå†²çªï¼ŒæŠ¥é”™

![image-20210927225218669](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927225218669.png)



å¦‚æœå’Œæ–‡ä»¶çš„å‘½åå†²çªï¼ŒæŠ¥é”™ï¼ˆosç»´æŠ¤çš„ç´¢å¼•è¡¨ï¼Œä¸å…è®¸åŒä¸€ç›®å½•ä¸‹å³åŒä¸€ç´¢å¼•è¡¨ä¸‹å‘½åç›¸åŒï¼‰

![image-20210927225427019](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927225427019.png)



### é€’å½’åˆ›å»ºå¤šçº§ç›®å½•

os.makedirs()

![image-20210928163107584](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928163107584.png)





### åˆ é™¤

æ–‡ä»¶å¤¹å­˜åœ¨

![image-20210927224838222](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927224838222.png)



![image-20210927224901477](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927224901477.png)



æ–‡ä»¶å¤¹éç©º

![image-20210927225619468](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927225619468.png)



æ–‡ä»¶å¤¹ä¸å­˜åœ¨

![image-20210927225636450](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927225636450.png)



### å½“å‰å·¥ä½œç›®å½•

os.getcwd()ï¼Œè¿”å›pythonè„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚å¦‚æœæœ‰å‡½æ•°è°ƒç”¨ï¼Œè¿”å›è°ƒç”¨å‡½æ•°æ‰€åœ¨ç›®å½•ï¼Œå³é¡¹ç›®çš„æ ¹ç›®å½•ã€‚



å•ç‹¬æ‰§è¡Œå‡½æ•°

![image-20210927223211883](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927223211883.png)



å‡½æ•°è°ƒç”¨

![image-20210927223234386](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210927223234386.png)

## è·¯å¾„

### æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„

os.path.isabs()ã€‚è‹¥è·¯å¾„ä¸ºç»å¯¹è·¯å¾„ï¼Œè¿”å›Trueã€‚

åˆ¤æ–­çš„åªæ˜¯å½¢å¼ï¼Œå¦‚æœè·¯å¾„ä¸å­˜åœ¨ä½†ä¸ºç»å¯¹è·¯å¾„ï¼Œä»ç„¶è¿”å›Trueã€‚

![image-20210928160228252](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928160228252.png)









## æ€»ç»“

| åŠŸèƒ½                | æ–‡ä»¶/æ–‡ä»¶å¤¹ | å‡½æ•°                        | è¯´æ˜                                                         |
| ------------------- | ----------- | --------------------------- | ------------------------------------------------------------ |
| å½“å‰è„šæœ¬çš„å·¥ä½œç›®å½•  |             | os.getcwd()                 | å¦‚æœæœ‰å‡½æ•°è°ƒç”¨ï¼Œè¿”å›çš„æ˜¯è°ƒç”¨å‡½æ•°æ‰€åœ¨æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•           |
|                     |             |                             |                                                              |
| æ–‡ä»¶/æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ | æ–‡ä»¶/æ–‡ä»¶å¤¹ | os.path.exists(path)        | å¦‚æœå­˜åœ¨è¿”å›Trueï¼Œå¦åˆ™è¿”å›False                              |
| é‡å‘½å              |             | os.rename(old,new)          | å¦‚æœæ²¡æœ‰oldè¿™ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼ŒæŠ¥é”™ï¼šFileNotFoundErrorï¼›å¦‚æœæœ‰å¹¶ä¸”newåˆæ³•ï¼Œä¿®æ”¹æ–‡ä»¶å |
|                     |             |                             |                                                              |
| æ˜¯ä¸æ˜¯æ–‡ä»¶          | æ–‡ä»¶        | os.path.isfile(path)        | æ˜¯æ–‡ä»¶ï¼Œè¿”å›Trueï¼›å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ–‡ä»¶å­˜åœ¨ä½†ä¸ºæ–‡ä»¶å¤¹ï¼Œè¿”å›False |
| åˆ é™¤æ–‡ä»¶            |             | os.remove(path)             | æ²¡æœ‰è¿”å›å€¼ï¼›å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæŠ¥é”™ï¼ŒFileNotFoundError        |
| åˆ›å»ºæ–‡ä»¶            |             | open                        | è®°å¾—å…³é—­æ–‡ä»¶                                                 |
| è·å¾—æ–‡ä»¶çš„æ‰©å±•å    |             | os.path.splitext(file_name) | è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå€¼æ˜¯æ–‡ä»¶åï¼Œç¬¬äºŒä¸ªå€¼æ˜¯åç¼€               |
|                     |             |                             |                                                              |
| æ˜¯ä¸æ˜¯æ–‡ä»¶å¤¹        | æ–‡ä»¶å¤¹      | os.path.isdir(path)         | æ˜¯æ–‡ä»¶å¤¹ï¼Œè¿”å›Trueï¼›å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ–‡ä»¶å­˜åœ¨ä½†ä¸ºæ–‡ä»¶ï¼Œè¿”å›False |
| åˆ›å»ºå•ä¸ªç›®å½•        |             | os.mkdir(path)              | æ²¡æœ‰è¿”å›å€¼ã€‚å¦‚æœåˆ›å»ºæ–‡ä»¶å¤¹çš„å‘½åå’Œæ–‡ä»¶ã€æ–‡ä»¶å¤¹å‘½åå†²çªï¼ŒæŠ¥é”™ï¼šFileExistsError |
| é€’å½’åˆ›å»ºå¤šçº§ç›®å½•    |             | os.makedirs()               | æ²¡æœ‰è¿”å›å€¼ï¼Œç›¸å½“äºlinuxçš„mkdir -p                            |
| åˆ é™¤ç›®å½•            |             | os.rmdir(path)              | 1ã€è‹¥æ–‡ä»¶å¤¹éç©ºï¼ŒæŠ¥é”™ï¼šOSError  2ã€è‹¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼ŒæŠ¥é”™ï¼šFileNotFoundError   3ã€è‹¥åˆ é™¤çš„æ˜¯æ–‡ä»¶ï¼ŒæŠ¥é”™ï¼šNotADirectoryError |
|                     |             |                             |                                                              |
| æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„      |             | os.path.isabs()             | åªæ˜¯å½¢å¼ä¸Šçš„åˆ¤æ–­ã€‚ä¸è€ƒè™‘è·¯å¾„æ˜¯å¦çœŸçš„å­˜åœ¨                     |
|                     |             |                             |                                                              |
|                     |             |                             |                                                              |
|                     |             |                             |                                                              |
|                     |             |                             |                                                              |
|                     |             |                             |                                                              |



# docker exex

ä¸»è¦ç”¨æ¥æ‰§è¡Œå®¹å™¨å†…çš„è„šæœ¬ï¼Œè¿™æ ·å°±ä¸ç”¨è¿›å…¥å®¹å™¨ï¼Œæ–¹ä¾¿åœ¨å®¹å™¨å¤–å†™è„šæœ¬ï¼Œå¿«é€Ÿè¿ç»´ã€‚

```bash
docker exex -d åœ¨åå°è¿è¡Œï¼ˆæœ€å¸¸ç”¨ï¼‰ container_name command arguments
		   -it ä»¥äº¤äº’æ¨¡å¼è¿è¡Œ
# åœ¨å®¹å™¨å†…
root@3bc427bb99a2:~# pwd
/root
root@3bc427bb99a2:~# cat 1.sh 
echo 'heello' >> /root/1.txt

# å®¹å™¨å¤–æ‰§è¡Œ
root@whr:~# docker exec -d test /bin/bash /root/1.sh

# å®¹å™¨å†…çš„ç»“æœ
root@3bc427bb99a2:~# ls
1.sh  1.txt  test.log  test.sh
root@3bc427bb99a2:~# cat 1.txt 
heello
```

# python loggingæ¨¡å—

é¦–å…ˆè¦å¯¹loggingæ¨¡å—ç™»è®°çš„ä¿¡æ¯è¿›è¡Œé…ç½®ã€‚

```python
```





# pythonå¯¼å…¥è‡ªå·±çš„æ¨¡å—

## è°ƒç”¨å‡½æ•°å’Œæ¨¡å—åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹

![image-20210928164107484](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210928164107484.png)



## è°ƒç”¨å‡½æ•°å’Œæ¨¡å—æ‰€åœ¨æ–‡ä»¶å¤¹åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹

![image-20210928164516743](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928164516743.png)



## è°ƒç”¨å‡½æ•°å’Œæ¨¡å—åœ¨åŒçº§ç›®å½•

### pycharmè¿è¡Œ

![image-20210928164713607](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928164713607.png)

è¿™ä¸ªé¡¹ç›®æ—¶å†pycharmä¸­åˆ›å»ºçš„ï¼Œpycharmä¼šä»¥é¡¹ç›®ç›®å½•ä¸ºæ ¹ç›®å½•è¿›è¡Œå¯»æ‰¾ã€‚

å¦‚æœå°†è¿™ä¸ªé¡¹ç›®ç§»åŠ¨åˆ°linuxå¹³å°å‘¢ï¼Ÿ



### linuxè¿è¡Œpycharmé¡¹ç›®

```bash
root@whr:/home/test# tree
.
â”œâ”€â”€ enter
â”‚Â Â  â””â”€â”€ call.py
â””â”€â”€ func
    â”œâ”€â”€ __pycache__
    â”‚Â Â  â””â”€â”€ __init__.cpython-36.pyc
    â””â”€â”€ test
        â”œâ”€â”€ called.py
        â””â”€â”€ __pycache__
            â””â”€â”€ called.cpython-36.pyc
root@whr:/home/test/enter# python3 call.py 
Traceback (most recent call last):
  File "call.py", line 1, in <module>
    from func.test import called
ModuleNotFoundError: No module named 'func'
```

è¿˜æ˜¯è¿è¡Œä¸äº†ã€‚

ç§»åŠ¨ä¸€ä¸‹æ–‡ä»¶ä½ç½®ã€‚

```bash
root@whr:/home/test# tree 
.
â”œâ”€â”€ call.py
â”œâ”€â”€ enter
â””â”€â”€ func
    â”œâ”€â”€ __pycache__
    â”‚Â Â  â””â”€â”€ __init__.cpython-36.pyc
    â””â”€â”€ test
        â”œâ”€â”€ called.py
        â””â”€â”€ __pycache__
            â””â”€â”€ called.cpython-36.pyc

5 directories, 4 files
root@whr:/home/test# python3 call.py 
hello world
```



### épycharmé¡¹ç›®

å¦‚æœä¸æ˜¯åœ¨pycharmä¸­æ–°å»ºçš„é¡¹ç›®ã€‚

```bash
D:\pythoncode\trash>tree
å· æ–°åŠ å· çš„æ–‡ä»¶å¤¹ PATH åˆ—è¡¨
å·åºåˆ—å·ä¸º F097-B144
D:.
â”œâ”€enter
â””â”€func
    â””â”€test

D:\pythoncode\trash>cd enter

D:\pythoncode\trash\enter>python call.py
Traceback (most recent call last):
  File "call.py", line 1, in <module>
    from func.test import called
ModuleNotFoundError: No module named 'func'
```

ä¼šæç¤ºæ‰¾ä¸åˆ°funcè¿™ä¸ªæ–‡ä»¶å¤¹

`åŒ…å°±æ˜¯ä¸€ä¸ªè‡³å°‘åŒ…å«__init__.pyæ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œå¦åˆ™ï¼ŒPythonå°±æŠŠè¿™ä¸ªç›®å½•å½“æˆæ™®é€šç›®å½•(æ–‡ä»¶å¤¹)ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŒ…ã€‚__init__.pyå¯ä»¥æ˜¯ç©ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æœ‰Pythonä»£ç ï¼Œå› ä¸º__init__.pyæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œè€Œå®ƒçš„æ¨¡å—åå°±æ˜¯å¯¹åº”åŒ…çš„åå­—ã€‚è°ƒç”¨åŒ…å°±æ˜¯æ‰§è¡ŒåŒ…ä¸‹çš„__init__.pyæ–‡ä»¶ã€‚`

è¦è®©è‡ªå·±çš„æ–‡ä»¶å¤¹è¢«pythonè§£é‡Šå™¨æ‰¾åˆ°ï¼Œæœ‰ä¸¤ä¸ªæ¡ä»¶ï¼š

- æ–‡ä»¶å¤¹æ˜¯åŒ…ï¼Œå³ç›®å½•ä¸‹æœ‰`__init__.py` æ–‡ä»¶ï¼Œä¸ç®¡å†…å®¹æ˜¯ä»€ä¹ˆï¼ˆå¯¼å…¥åŒ…æ—¶ï¼Œé¦–å…ˆæ‰§è¡Œ`__init__.pyæ–‡ä»¶`)ã€‚
- å°†é¡¹ç›®è·¯å¾„å‘Šè¯‰python

æ¯”å¦‚ï¼šbs4

![image-20210928183908837](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928183908837.png)



![image-20210928183910773](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928183910773.png)



è¿™æ ·è¿›è¡Œä¿®æ”¹ã€‚åœ¨åŒ…çš„ç›®å½•ä¸­éƒ½åŠ å…¥initæ–‡ä»¶ï¼Œå°†é¡¹ç›®ç›®å½•æ”¾åˆ°pathä¸‹ã€‚

![image-20210928185014574](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928185014574.png)



![image-20210928185034525](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928185034525.png)

call.py

```python
import sys
sys.path.append(r'D:\pythoncode\trash')

from func.test import called
called.func()
```

å°†é¡¹ç›®ç›®å½•å‘Šè¯‰pythonè§£é‡Šå™¨ã€‚



åœ¨funcç›®å½•ä¸‹æœ‰initæ–‡ä»¶

![image-20210928185140749](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928185140749.png)

`__init__.py`

```python
if __name__ == '__main__':
    print('funcä½œä¸ºå…¥å£å‡½æ•°è¿è¡Œ')
else:
    print('funcä½œä¸ºåŒ…è¿è¡Œ')
```



åœ¨funcç›®å½•ä¸‹æœ‰initæ–‡ä»¶

![image-20210928185210580](https://raw.githubusercontent.com/whr819987540/pic/main/image-20210928185210580.png)

`__init__.py`

```python
if __name__ == '__main__':
    print('func.testä½œä¸ºå…¥å£å‡½æ•°è¿è¡Œ')
else:
    print('func.testä½œä¸ºåŒ…è¿è¡Œ')
```



åœ¨cmdä¸‹è¿è¡Œ

```bash
D:\pythoncode\trash\enter>python call.py
funcä½œä¸ºåŒ…è¿è¡Œ
func.testä½œä¸ºåŒ…è¿è¡Œ
hello world
```



åœ¨linuxä¸‹è¿è¡Œï¼ˆå°†é¡¹ç›®ç›®å½•æ”¹ä¸€ä¸‹ï¼‰

```bash
root@whr:/home/test/enter# python3 call.py 
funcä½œä¸ºåŒ…è¿è¡Œ
func.testä½œä¸ºåŒ…è¿è¡Œ
hello world
```



#### æ ¸å¿ƒé—®é¢˜

- å‘Šè¯‰pythonè§£é‡Šå™¨å»å“ªå„¿æ‰¾
  - sys.path.append(é¡¹ç›®ç›®å½•)
- å°†ç›®å½•åˆ¶ä½œæˆåŒ…
  - åŠ ä¸Š`__init__.py`æ–‡ä»¶





# lsç»“æœè½¬datetime

```bash
ls -l --time-style '+%Y-%m-%d-%H-%M-%S'
nslab@nslab:~$ ls -l --time-style '+%Y-%m-%d-%H-%M-%S'
total 96
-rw-r--r--  1 nslab            nslab 11584 2021-09-03-19-54-08 cluster_control.py
-rw-rw-r--  1 nslab            nslab    72 2021-08-03-05-39-28 ctc.txt
drwxrwxr-x  4 systemd-coredump nslab  4096 2021-08-09-20-31-06 data
```



```python
import datetime,os
mtimes = os.popen("ls -l --time-style '+%Y-%m-%d-%H-%M-%S'").read().strip().split('\n')[1:]
mtimes = [ i.split()[-2] for i in mtimes]
for mtime in mtimes:
    mtime_datetime = datetime.datetime.strptime(mtime,'%Y-%m-%d-%H-%M-%S')
    print(mtime_datetime)
    print(mtime_datetime.strftime('%Y-%m-%d'))
```





mogodbï¼Œredis

åæ¥å…ˆæœåŠ¡ã€‚ç›®æ ‡é¡µå’Œå‘ç°é¡µäº¤æ›¿è¿›è¡Œã€‚



æ•°æ®ä»‹ç»ã€‚

å…³é”®è¯çš„ä¸°å¯Œï¼Œå¦‚ä½•ä¸°å¯Œå…³é”®è¯ï¼Ÿ



ä»»åŠ¡è°ƒåº¦ç›¸å…³æ–‡ç« 

å‘ä¸“åˆ©ã€‚

æ•°æ®ï¼ˆmysqlï¼Œå›¾ç‰‡ï¼‰pullå›å­¦æ ¡ã€‚

å›¾ç‰‡pullåˆ°æœ¬åœ°ã€‚

ç»Ÿè®¡æ•°æ®ï¼šä»¥ä¸€å°å…¬ç½‘æœºå™¨ä¸ºä¸­è½¬ï¼Œå›ä¼ ç»Ÿè®¡æ•°æ®åˆ°å­¦æ ¡ã€‚

çœ‹æ–‡ç« ï¼ˆè‹±æ–‡è®ºæ–‡ï¼‰





# numpy

## numpy.arrayæ¯”è¾ƒæ˜¯å¦ç›¸åŒ

- (array_1==array_2)

```python
>>> a = np.array([1,2,3])
>>> b = np.array([1,2,3])
>>> c = np.array([1,2,4])
>>> a == b
array([ True,  True,  True])
>>> a == c
array([ True,  True, False])
```

- (array_1 == array_2).all()

åªæœ‰å½“array_1å’Œarray_2æ‰€æœ‰å…ƒç´ éƒ½å¯¹åº”ç›¸ç­‰æ—¶æ‰è¿”å›ä¸€ä¸ªTrueï¼Œå¦åˆ™è¿”å›False

```python
>>> a = np.array([1,2,3])
>>> b = np.array([1,2,3])
>>> c = np.array([1,2,4])
>>> (a == b).all()
True
>>> (a == c).all()
False
```

- (array_1 == array_2).any()

å½“array_1å’Œarray_2ä¸­å­˜åœ¨ä¸€ä¸ªå…ƒç´ å¯¹åº”ç›¸ç­‰æ—¶å°±è¿”å›ä¸€ä¸ªTrue

åªæœ‰å½“æ‰€æœ‰å¯¹åº”å…ƒç´ éƒ½ä¸ç›¸ç­‰æ—¶ï¼Œæ‰è¿”å›False

```python
>>> a = np.array([1,2,3])
>>> b = np.array([1,2,3])
>>> c = np.array([1,2,4])
>>> (a == b).any()
True
>>> (a == c).any()
True

```

